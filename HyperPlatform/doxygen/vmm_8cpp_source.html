<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>HyperPlatform: HyperPlatform/vmm.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HyperPlatform
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_16fcf1458aec6cdcd2284700b6c28d4a.html">HyperPlatform</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">vmm.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="vmm_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright (c) 2015-2016, tandasat. All rights reserved.</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// Use of this source code is governed by a MIT-style license that can be</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// found in the LICENSE file.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="vmm_8h.html">vmm.h</a>&quot;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;intrin.h&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="asm_8h.html">asm.h</a>&quot;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="common_8h.html">common.h</a>&quot;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ept_8h.html">ept.h</a>&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="log_8h.html">log.h</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="util_8h.html">util.h</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#ifndef HYPERPLATFORM_PERFORMANCE_ENABLE_PERFCOUNTER</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#define HYPERPLATFORM_PERFORMANCE_ENABLE_PERFCOUNTER 1</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#endif  // HYPERPLATFORM_PERFORMANCE_ENABLE_PERFCOUNTER</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="performance_8h.html">performance.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">// macro utilities</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">// constants and macros</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">// Whether VM-exit recording is enabled</span></div>
<div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#a73a3bbff0ce5ead5ccb895cb9f948e65">   32</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">long</span> <a class="code" href="vmm_8cpp.html#a73a3bbff0ce5ead5ccb895cb9f948e65">kVmmpEnableRecordVmExit</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">// How many events should be recorded per a processor</span></div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#a0c357682b4fe2b2c769a2471c988131f">   35</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">long</span> <a class="code" href="vmm_8cpp.html#a0c357682b4fe2b2c769a2471c988131f">kVmmpNumberOfRecords</a> = 100;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">// How many processors are supported for recording</span></div>
<div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#a8b9043c100c0991d06d72d04328d8c0c">   38</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">long</span> <a class="code" href="vmm_8cpp.html#a8b9043c100c0991d06d72d04328d8c0c">kVmmpNumberOfProcessors</a> = 4;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">// types</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">// Represents raw structure of stack of VMM when VmmVmExitHandler() is called</span></div>
<div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="struct_vmm_initial_stack.html">   46</a></span>&#160;<span class="keyword">struct </span><a class="code" href="struct_vmm_initial_stack.html">VmmInitialStack</a> {</div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="struct_vmm_initial_stack.html#a6b89b9f39309c193706089082eac50f6">   47</a></span>&#160;  <a class="code" href="struct_gp_registers_x86.html">GpRegisters</a> <a class="code" href="struct_vmm_initial_stack.html#a6b89b9f39309c193706089082eac50f6">gp_regs</a>;</div>
<div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="struct_vmm_initial_stack.html#a71969f00b28abe92d6bdc28127c782b6">   48</a></span>&#160;  ULONG_PTR <a class="code" href="struct_vmm_initial_stack.html#a71969f00b28abe92d6bdc28127c782b6">reserved</a>;</div>
<div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="struct_vmm_initial_stack.html#a6470c7e65bd6a19c2afa6220943f38e1">   49</a></span>&#160;  <a class="code" href="struct_processor_data.html">ProcessorData</a> *<a class="code" href="struct_vmm_initial_stack.html#a6470c7e65bd6a19c2afa6220943f38e1">processor_data</a>;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;};</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">// Things need to be read and written by each VM-exit handler</span></div>
<div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="struct_guest_context.html">   53</a></span>&#160;<span class="keyword">struct </span><a class="code" href="struct_guest_context.html">GuestContext</a> {</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="keyword">union </span>{</div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="struct_guest_context.html#a5137680c60d5726f6cec0e925d9b25b1">   55</a></span>&#160;    <a class="code" href="struct_vmm_initial_stack.html">VmmInitialStack</a> *<a class="code" href="struct_guest_context.html#a5137680c60d5726f6cec0e925d9b25b1">stack</a>;</div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">   56</a></span>&#160;    <a class="code" href="struct_gp_registers_x86.html">GpRegisters</a> *<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  };</div>
<div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="struct_guest_context.html#a387d47754ddefc13d947494ac049d9e8">   58</a></span>&#160;  <a class="code" href="union_flag_register.html">FlagRegister</a> <a class="code" href="struct_guest_context.html#a387d47754ddefc13d947494ac049d9e8">flag_reg</a>;</div>
<div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="struct_guest_context.html#abc69d3291f49cb0014a9b03f0e7fe57e">   59</a></span>&#160;  ULONG_PTR <a class="code" href="struct_guest_context.html#abc69d3291f49cb0014a9b03f0e7fe57e">ip</a>;</div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="struct_guest_context.html#a119437e05b54a8082c042df7df80d320">   60</a></span>&#160;  ULONG_PTR <a class="code" href="struct_guest_context.html#a119437e05b54a8082c042df7df80d320">cr8</a>;</div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="struct_guest_context.html#a01bf10f212de6a6b8e6146619749f433">   61</a></span>&#160;  KIRQL <a class="code" href="struct_guest_context.html#a01bf10f212de6a6b8e6146619749f433">irql</a>;</div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="struct_guest_context.html#ad5fde384d1b94f80cec6f1ffa0f2327c">   62</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="struct_guest_context.html#ad5fde384d1b94f80cec6f1ffa0f2327c">vm_continue</a>;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;};</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#if defined(_AMD64_)</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;static_assert(<span class="keyword">sizeof</span>(<a class="code" href="struct_guest_context.html">GuestContext</a>) == 40, <span class="stringliteral">&quot;Size check&quot;</span>);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;static_assert(<span class="keyword">sizeof</span>(<a class="code" href="struct_guest_context.html">GuestContext</a>) == 20, <span class="stringliteral">&quot;Size check&quot;</span>);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">// Context at the moment of vmexit</span></div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="struct_vm_exit_history.html">   71</a></span>&#160;<span class="keyword">struct </span><a class="code" href="struct_vm_exit_history.html">VmExitHistory</a> {</div>
<div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="struct_vm_exit_history.html#ae2de9c4bc442c47de3dc81b018a1738a">   72</a></span>&#160;  <a class="code" href="struct_gp_registers_x86.html">GpRegisters</a> <a class="code" href="struct_vm_exit_history.html#ae2de9c4bc442c47de3dc81b018a1738a">gp_regs</a>;</div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="struct_vm_exit_history.html#a3ab2f6965ead4e01f6141ce84ed27f47">   73</a></span>&#160;  ULONG_PTR <a class="code" href="struct_vm_exit_history.html#a3ab2f6965ead4e01f6141ce84ed27f47">ip</a>;</div>
<div class="line"><a name="l00074"></a><span class="lineno"><a class="line" href="struct_vm_exit_history.html#ac8168e9d3351a5af2729709a8a685fbd">   74</a></span>&#160;  <a class="code" href="union_vm_exit_information.html">VmExitInformation</a> <a class="code" href="struct_vm_exit_history.html#ac8168e9d3351a5af2729709a8a685fbd">exit_reason</a>;</div>
<div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="struct_vm_exit_history.html#a412ad5fbaba05cfe66f3db580efc29df">   75</a></span>&#160;  ULONG_PTR <a class="code" href="struct_vm_exit_history.html#a412ad5fbaba05cfe66f3db580efc29df">exit_qualification</a>;</div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="struct_vm_exit_history.html#a41ddef6ad3fc5d52efebb34ff46054ed">   76</a></span>&#160;  ULONG_PTR <a class="code" href="struct_vm_exit_history.html#a41ddef6ad3fc5d52efebb34ff46054ed">instruction_info</a>;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;};</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">// prototypes</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="keywordtype">bool</span> __stdcall <a class="code" href="vmm_8cpp.html#aa596f94adf844e3a4e19d664c07d9968">VmmVmExitHandler</a>(_Inout_ <a class="code" href="struct_vmm_initial_stack.html">VmmInitialStack</a> *stack);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;DECLSPEC_NORETURN <span class="keywordtype">void</span> __stdcall <a class="code" href="vmm_8cpp.html#ab949fa6efd53abc611bcfa0e41e20cf0">VmmVmxFailureHandler</a>(</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    _Inout_ <a class="code" href="struct_all_registers.html">AllRegisters</a> *all_regs);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a86625e8afcfcba068b8785da1aef74e2">VmmpHandleVmExit</a>(_Inout_ <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;DECLSPEC_NORETURN <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#ade8bb0841b4ed7f6fd3888cbd1963ffb">VmmpHandleTripleFault</a>(</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    _Inout_ <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;DECLSPEC_NORETURN <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#aacfe3935f1fc13bf1f13dfb576475949">VmmpHandleUnexpectedExit</a>(</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    _Inout_ <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a4dd19279ad356f9d6c2f43601b2f233a">VmmpHandleException</a>(_Inout_ <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a7f4e7c5082162a3712e75eafecfd246f">VmmpHandleCpuid</a>(_Inout_ <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a8c74dd7423915a0a5900fda92ea9f729">VmmpHandleRdtsc</a>(_Inout_ <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a5a138d54b705286e8ebf2ae1c84763b9">VmmpHandleRdtscp</a>(_Inout_ <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#aa7cfdb9078ff33633b0a2d00754b121f">VmmpHandleXsetbv</a>(_Inout_ <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a076579c5628cc2f15b0713f218cb6bed">VmmpHandleMsrReadAccess</a>(_Inout_ <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#aca9ba59e93c665bb5b0b0cb82696ad23">VmmpHandleMsrWriteAccess</a>(_Inout_ <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#ae335e24227daf5739435eeb6789142a6">VmmpHandleMsrAccess</a>(_Inout_ <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context,</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                                _In_ <span class="keywordtype">bool</span> read_access);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a5287d4b4b503b93a18fa48277f365997">VmmpHandleGdtrOrIdtrAccess</a>(_Inout_ <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#aa5d99c76ea02860a68441b9f3a584178">VmmpHandleLdtrOrTrAccess</a>(_Inout_ <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#af96290550a514b6931f9eca8a3dda239">VmmpHandleDrAccess</a>(_Inout_ <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a9dd0aea373b81895ec20012fc9b1a546">VmmpHandleCrAccess</a>(_Inout_ <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a7889383e3e67c7507cde12bd68c0edd3">VmmpHandleVmx</a>(_Inout_ <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a0c35206d6bd25f8caa79ab139ff725a5">VmmpHandleVmCall</a>(_Inout_ <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a25ec906723d7f199fc49a820cfcb1e8c">VmmpHandleInvalidateInternalCaches</a>(</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    _Inout_ <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#ad2045ccea55ea3345f22cdb7e2a9a6ba">VmmpHandleInvalidateTLBEntry</a>(_Inout_ <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a3a8844706155374466e6af3d451ab567">VmmpHandleEptViolation</a>(_Inout_ <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a5a9b39b7dbbe8954e087bb61db6be81c">VmmpHandleEptMisconfig</a>(_Inout_ <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="keyword">static</span> ULONG_PTR *<a class="code" href="vmm_8cpp.html#a1c01a0073985999db6eaf5836fdaf56a">VmmpSelectRegister</a>(_In_ ULONG index,</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                                     _In_ <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a558ceb9b748edc1d0d0a881d98ebc62b">VmmpDumpGuestSelectors</a>();</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a74d575262c9085bf28b9de246129c17e">VmmpAdjustGuestInstructionPointer</a>(_In_ ULONG_PTR guest_ip);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">// variables</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">// Those variables are all for diagnostic purpose</span></div>
<div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#a8d1112d4612a2a6b2b56eb39ae3ed539">  148</a></span>&#160;<span class="keyword">static</span> ULONG <a class="code" href="vmm_8cpp.html#a8d1112d4612a2a6b2b56eb39ae3ed539">g_vmmp_next_history_index</a>[<a class="code" href="vmm_8cpp.html#a8b9043c100c0991d06d72d04328d8c0c">kVmmpNumberOfProcessors</a>];</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="keyword">static</span> <a class="code" href="struct_vm_exit_history.html">VmExitHistory</a></div>
<div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#a6e683d7408cf291fb1131a178c0d133f">  150</a></span>&#160;    <a class="code" href="vmm_8cpp.html#a6e683d7408cf291fb1131a178c0d133f">g_vmmp_vm_exit_history</a>[<a class="code" href="vmm_8cpp.html#a8b9043c100c0991d06d72d04328d8c0c">kVmmpNumberOfProcessors</a>][<a class="code" href="vmm_8cpp.html#a0c357682b4fe2b2c769a2471c988131f">kVmmpNumberOfRecords</a>];</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">// implementations</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">// A high level VMX handler called from AsmVmExitHandler().</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">// Return true for vmresume, or return false for vmxoff.</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="preprocessor">#pragma warning(push)</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="preprocessor">#pragma warning(disable : 28167)</span></div>
<div class="line"><a name="l00161"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#a0b5194dc665a7b443962c76e096cf9b6">  161</a></span>&#160;_Use_decl_annotations_ <span class="keywordtype">bool</span> __stdcall <a class="code" href="vmm_8cpp.html#aa596f94adf844e3a4e19d664c07d9968">VmmVmExitHandler</a>(<a class="code" href="struct_vmm_initial_stack.html">VmmInitialStack</a> *stack) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="comment">// Save guest&#39;s context and raise IRQL as quick as possible</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> guest_irql = KeGetCurrentIrql();</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> guest_cr8 = <a class="code" href="common_8h.html#ae06c86efd7f271e00cb4f501fbca6e1a">IsX64</a>() ? __readcr8() : 0;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="keywordflow">if</span> (guest_irql &lt; DISPATCH_LEVEL) {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    KeRaiseIrqlToDpcLevel();</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  }</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  NT_ASSERT(stack-&gt;<a class="code" href="struct_vmm_initial_stack.html#a71969f00b28abe92d6bdc28127c782b6">reserved</a> == MAXULONG_PTR);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="comment">// Capture the current guest state</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <a class="code" href="struct_guest_context.html">GuestContext</a> guest_context = {stack,</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                                <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba7c4ad323abdb427c1cee8152c50a2953">VmcsField::kGuestRflags</a>),</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                                <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba73fa622f28ef655069a049bbeb89fbdf">VmcsField::kGuestRip</a>),</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                                guest_cr8,</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                                guest_irql,</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                                <span class="keyword">true</span>};</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  guest_context.<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a01ff4b8d095922bbe45840bf2192c361">sp</a> = <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba3d82afd83745ee0d6e5fa539e40d8ce7">VmcsField::kGuestRsp</a>);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="comment">// Dispatch the current VM-exit event</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <a class="code" href="vmm_8cpp.html#a86625e8afcfcba068b8785da1aef74e2">VmmpHandleVmExit</a>(&amp;guest_context);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="comment">// Restore guest&#39;s context</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordflow">if</span> (guest_context.<a class="code" href="struct_guest_context.html#a01bf10f212de6a6b8e6146619749f433">irql</a> &lt; DISPATCH_LEVEL) {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    KeLowerIrql(guest_context.<a class="code" href="struct_guest_context.html#a01bf10f212de6a6b8e6146619749f433">irql</a>);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="comment">// Apply possibly updated CR8 by the handler</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="common_8h.html#ae06c86efd7f271e00cb4f501fbca6e1a">IsX64</a>()) {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    __writecr8(guest_context.<a class="code" href="struct_guest_context.html#a119437e05b54a8082c042df7df80d320">cr8</a>);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  }</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="keywordflow">return</span> guest_context.<a class="code" href="struct_guest_context.html#ad5fde384d1b94f80cec6f1ffa0f2327c">vm_continue</a>;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;}</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="preprocessor">#pragma warning(pop)</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">// Dispatches VM-exit to a corresponding handler</span></div>
<div class="line"><a name="l00196"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#afc03e4ea13322aeec9ddad7c9fbb93b3">  196</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a86625e8afcfcba068b8785da1aef74e2">VmmpHandleVmExit</a>(</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context) {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <a class="code" href="performance_8h.html#a177eecc7a326a434e5c1667cc83a8f03">HYPERPLATFORM_PERFORMANCE_MEASURE_THIS_SCOPE</a>();</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="keyword">const</span> <a class="code" href="union_vm_exit_information.html">VmExitInformation</a> exit_reason = {</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      <span class="keyword">static_cast&lt;</span>ULONG32<span class="keyword">&gt;</span>(<a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbabcfc687436663f7b8c8ae76cdde90701">VmcsField::kVmExitReason</a>))};</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keywordflow">if</span> (kVmmpEnableRecordVmExit) {</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment">// Save them for ease of trouble shooting</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> processor = KeGetCurrentProcessorNumber();</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keyword">auto</span> &amp;index = g_vmmp_next_history_index[processor];</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keyword">auto</span> &amp;history = <a class="code" href="vmm_8cpp.html#a6e683d7408cf291fb1131a178c0d133f">g_vmmp_vm_exit_history</a>[processor][index];</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    history.<a class="code" href="struct_vm_exit_history.html#ae2de9c4bc442c47de3dc81b018a1738a">gp_regs</a> = *guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    history.ip = guest_context-&gt;<a class="code" href="struct_guest_context.html#abc69d3291f49cb0014a9b03f0e7fe57e">ip</a>;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    history.exit_reason = exit_reason;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    history.exit_qualification = <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba7803322c278f9bbfe4ca10d4046b20d6">VmcsField::kExitQualification</a>);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    history.instruction_info = <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba7a823dc9b77787fd973d184fcd05bc1b">VmcsField::kVmxInstructionInfo</a>);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">if</span> (++index == kVmmpNumberOfRecords) {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      index = 0;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordflow">switch</span> (exit_reason.<a class="code" href="union_vm_exit_information.html#a5a8a912813aa7d49a9395e53f56de5a6">fields</a>.<a class="code" href="union_vm_exit_information.html#aca1d0a24280bc09c427263b0f2ae4370">reason</a>) {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9eab290f1c7552c2313218c85a8edf2e799">VmxExitReason::kExceptionOrNmi</a>:</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <a class="code" href="vmm_8cpp.html#a4dd19279ad356f9d6c2f43601b2f233a">VmmpHandleException</a>(guest_context);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea3744e91fc225ce5a4f100c83dd3e8897">VmxExitReason::kTripleFault</a>:</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      <a class="code" href="vmm_8cpp.html#ade8bb0841b4ed7f6fd3888cbd1963ffb">VmmpHandleTripleFault</a>(guest_context);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9eafb9bf53051f3d437739b34bbd6a570f5">VmxExitReason::kCpuid</a>:</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      <a class="code" href="vmm_8cpp.html#a7f4e7c5082162a3712e75eafecfd246f">VmmpHandleCpuid</a>(guest_context);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea83cb55cfd5b579a9454777887458cff4">VmxExitReason::kInvd</a>:</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      <a class="code" href="vmm_8cpp.html#a25ec906723d7f199fc49a820cfcb1e8c">VmmpHandleInvalidateInternalCaches</a>(guest_context);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ead84d21d1dd4f4776d77142f7344d60d9">VmxExitReason::kInvlpg</a>:</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      <a class="code" href="vmm_8cpp.html#ad2045ccea55ea3345f22cdb7e2a9a6ba">VmmpHandleInvalidateTLBEntry</a>(guest_context);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9eaa1ad9009b0e9469600233988337ec4ae">VmxExitReason::kRdtsc</a>:</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <a class="code" href="vmm_8cpp.html#a8c74dd7423915a0a5900fda92ea9f729">VmmpHandleRdtsc</a>(guest_context);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea440a40769c0750c23d47bf35660f2fdc">VmxExitReason::kCrAccess</a>:</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      <a class="code" href="vmm_8cpp.html#a9dd0aea373b81895ec20012fc9b1a546">VmmpHandleCrAccess</a>(guest_context);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea7e8200b4c01953425c19a0a7252cb0e8">VmxExitReason::kDrAccess</a>:</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      <a class="code" href="vmm_8cpp.html#af96290550a514b6931f9eca8a3dda239">VmmpHandleDrAccess</a>(guest_context);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea392e859b66b58678566f8cb982cc36f0">VmxExitReason::kMsrRead</a>:</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <a class="code" href="vmm_8cpp.html#a076579c5628cc2f15b0713f218cb6bed">VmmpHandleMsrReadAccess</a>(guest_context);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9eadc032bcdb030aa32caacc1539d36b27e">VmxExitReason::kMsrWrite</a>:</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <a class="code" href="vmm_8cpp.html#aca9ba59e93c665bb5b0b0cb82696ad23">VmmpHandleMsrWriteAccess</a>(guest_context);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea46e509c67d7ad363dad1a02a12c5ae59">VmxExitReason::kGdtrOrIdtrAccess</a>:</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <a class="code" href="vmm_8cpp.html#a5287d4b4b503b93a18fa48277f365997">VmmpHandleGdtrOrIdtrAccess</a>(guest_context);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea6f6a3466e7ce5d73ba86fba2ae9edfcf">VmxExitReason::kLdtrOrTrAccess</a>:</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <a class="code" href="vmm_8cpp.html#aa5d99c76ea02860a68441b9f3a584178">VmmpHandleLdtrOrTrAccess</a>(guest_context);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea5e1b8a6ff6f3b933c6b5c9efad006c4f">VmxExitReason::kEptViolation</a>:</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <a class="code" href="vmm_8cpp.html#a3a8844706155374466e6af3d451ab567">VmmpHandleEptViolation</a>(guest_context);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea8114300f5edaa7679e348df4386f0e74">VmxExitReason::kEptMisconfig</a>:</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <a class="code" href="vmm_8cpp.html#a5a9b39b7dbbe8954e087bb61db6be81c">VmmpHandleEptMisconfig</a>(guest_context);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9eaa8801b22dbe213af1b02ff16f53c7f87">VmxExitReason::kVmcall</a>:</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <a class="code" href="vmm_8cpp.html#a0c35206d6bd25f8caa79ab139ff725a5">VmmpHandleVmCall</a>(guest_context);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ead86d6ae12f548eefcff89550cb6b2f3d">VmxExitReason::kVmclear</a>:</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea314050a14997075f3822679589dcbcea">VmxExitReason::kVmlaunch</a>:</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea1311497c9bd49aed82c0e26d5f9af165">VmxExitReason::kVmptrld</a>:</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea1de4c6d7f745f23d4e034b3e59961e75">VmxExitReason::kVmptrst</a>:</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9eaad2af80a0c01945b951659e23c2a008a">VmxExitReason::kVmread</a>:</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea72788e267bbcc9e8bbd542bdbc8fce13">VmxExitReason::kVmresume</a>:</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea1811c2565bed5527991294be7fad52d3">VmxExitReason::kVmwrite</a>:</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9eadc7bdda44f5036c1c070bcd34baf8eb9">VmxExitReason::kVmoff</a>:</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea9d5222f0fa2a9758d85e96e31a3cc294">VmxExitReason::kVmon</a>:</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      <a class="code" href="vmm_8cpp.html#a7889383e3e67c7507cde12bd68c0edd3">VmmpHandleVmx</a>(guest_context);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9eadd061a9d46c215e553ab549208c6dc65">VmxExitReason::kRdtscp</a>:</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      <a class="code" href="vmm_8cpp.html#a5a138d54b705286e8ebf2ae1c84763b9">VmmpHandleRdtscp</a>(guest_context);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9eaa6863cb53d5be0e0a58837f7a2445281">VmxExitReason::kXsetbv</a>:</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <a class="code" href="vmm_8cpp.html#aa7cfdb9078ff33633b0a2d00754b121f">VmmpHandleXsetbv</a>(guest_context);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <a class="code" href="vmm_8cpp.html#aacfe3935f1fc13bf1f13dfb576475949">VmmpHandleUnexpectedExit</a>(guest_context);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;}</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">// Triple fault VM-exit. Fatal error.</span></div>
<div class="line"><a name="l00289"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#ac526648f9f586d88be838cb842203952">  289</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#ade8bb0841b4ed7f6fd3888cbd1963ffb">VmmpHandleTripleFault</a>(</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context) {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <a class="code" href="vmm_8cpp.html#a558ceb9b748edc1d0d0a881d98ebc62b">VmmpDumpGuestSelectors</a>();</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <a class="code" href="common_8h.html#a2fa75a42dd2f34590bed16f1583b2a9c">HYPERPLATFORM_COMMON_BUG_CHECK</a>(<a class="code" href="common_8h.html#a025de454ae4eec948d955fd67b2c1a47af882ecbdd08f4b410b82ca4894208040">HyperPlatformBugCheck::kTripleFaultVmExit</a>,</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                                 reinterpret_cast&lt;ULONG_PTR&gt;(guest_context),</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                                 guest_context-&gt;<a class="code" href="struct_guest_context.html#abc69d3291f49cb0014a9b03f0e7fe57e">ip</a>, 0);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;}</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">// Unexpected VM-exit. Fatal error.</span></div>
<div class="line"><a name="l00298"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#aea7bf3dfc2e08f551c951186a118bfc5">  298</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#aacfe3935f1fc13bf1f13dfb576475949">VmmpHandleUnexpectedExit</a>(</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context) {</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <a class="code" href="vmm_8cpp.html#a558ceb9b748edc1d0d0a881d98ebc62b">VmmpDumpGuestSelectors</a>();</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <a class="code" href="common_8h.html#a2fa75a42dd2f34590bed16f1583b2a9c">HYPERPLATFORM_COMMON_BUG_CHECK</a>(<a class="code" href="common_8h.html#a025de454ae4eec948d955fd67b2c1a47aaab5123b0ff34361100d04874b2846b0">HyperPlatformBugCheck::kUnexpectedVmExit</a>,</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                                 reinterpret_cast&lt;ULONG_PTR&gt;(guest_context), 0,</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                                 0);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;}</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">// Interrupt</span></div>
<div class="line"><a name="l00307"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#af1e29840082977c2dcaf68b21e5a6aa0">  307</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a4dd19279ad356f9d6c2f43601b2f233a">VmmpHandleException</a>(</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context) {</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <a class="code" href="performance_8h.html#a177eecc7a326a434e5c1667cc83a8f03">HYPERPLATFORM_PERFORMANCE_MEASURE_THIS_SCOPE</a>();</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="keyword">const</span> <a class="code" href="union_vm_exit_interruption_information_field.html">VmExitInterruptionInformationField</a> exception = {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="keyword">static_cast&lt;</span>ULONG32<span class="keyword">&gt;</span>(<a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba5d3f11ca12032bc442c72c5953a99898">VmcsField::kVmExitIntrInfo</a>))};</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="keywordflow">if</span> (static_cast&lt;interruption_type&gt;(exception.<a class="code" href="union_vm_exit_interruption_information_field.html#a68bd7ad6a7be7847d637740d32902124">fields</a>.<a class="code" href="union_vm_exit_interruption_information_field.html#afc0d177a9ebf865624eac98a3ea8367c">interruption_type</a>) ==</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      <a class="code" href="ia32__type_8h.html#af02f226cd3a56b4fcc0a54efc9e89d68aeaabae89931ae24f2288931cbe332dcb">interruption_type::kHardwareException</a>) {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="comment">// Hardware exception</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">if</span> (static_cast&lt;InterruptionVector&gt;(exception.<a class="code" href="union_vm_exit_interruption_information_field.html#a68bd7ad6a7be7847d637740d32902124">fields</a>.<a class="code" href="union_vm_exit_interruption_information_field.html#a05324c3bd75ef11750ed9a2f2db30b2e">vector</a>) ==</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <a class="code" href="ia32__type_8h.html#a09188c6f080645a99f9da56aa389ae10aa9ab9f1feab44af5e2ae4864eceed30c">InterruptionVector::kPageFaultException</a>) {</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="comment">// #PF</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      <span class="keyword">const</span> <a class="code" href="union_page_fault_error_code.html">PageFaultErrorCode</a> fault_code = {</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;          <span class="keyword">static_cast&lt;</span>ULONG32<span class="keyword">&gt;</span>(<a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba9757b2880044df6a4ea8f05d5130af8a">VmcsField::kVmExitIntrErrorCode</a>))};</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> fault_address = <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba7803322c278f9bbfe4ca10d4046b20d6">VmcsField::kExitQualification</a>);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <a class="code" href="union_vm_entry_interruption_information_field.html">VmEntryInterruptionInformationField</a> inject = {};</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      inject.<a class="code" href="union_vm_entry_interruption_information_field.html#a7240d1c95f4ec56ea07c470ccb5e7716">fields</a>.<a class="code" href="union_vm_entry_interruption_information_field.html#aa4708a2c6b44a05b9f05354626106b62">interruption_type</a> = exception.<a class="code" href="union_vm_exit_interruption_information_field.html#a68bd7ad6a7be7847d637740d32902124">fields</a>.<a class="code" href="union_vm_exit_interruption_information_field.html#afc0d177a9ebf865624eac98a3ea8367c">interruption_type</a>;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      inject.<a class="code" href="union_vm_entry_interruption_information_field.html#a7240d1c95f4ec56ea07c470ccb5e7716">fields</a>.<a class="code" href="union_vm_entry_interruption_information_field.html#aed60e16c758588e355861917f2a4f1d0">vector</a> = exception.<a class="code" href="union_vm_exit_interruption_information_field.html#a68bd7ad6a7be7847d637740d32902124">fields</a>.<a class="code" href="union_vm_exit_interruption_information_field.html#a05324c3bd75ef11750ed9a2f2db30b2e">vector</a>;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      inject.<a class="code" href="union_vm_entry_interruption_information_field.html#a7240d1c95f4ec56ea07c470ccb5e7716">fields</a>.<a class="code" href="union_vm_entry_interruption_information_field.html#afc19f2e9d19eb6880276bdb355d63119">deliver_error_code</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      inject.<a class="code" href="union_vm_entry_interruption_information_field.html#a7240d1c95f4ec56ea07c470ccb5e7716">fields</a>.<a class="code" href="union_vm_entry_interruption_information_field.html#a97f3a81fc1e370f877b35135a6fdad97">valid</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      <a class="code" href="asm_8h.html#a55f8f0cb783f43b81d084ed8c54b63eb">AsmWriteCR2</a>(fault_address);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <a class="code" href="util_8cpp.html#a47aa45a9e2a816d5cf54a0173d4e786f">UtilVmWrite</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaa0e5b39f35a832fd9621f0bb57200d86">VmcsField::kVmEntryExceptionErrorCode</a>, fault_code.<a class="code" href="union_page_fault_error_code.html#a32d292646865e1b4a7292bf08c7fe448">all</a>);</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <a class="code" href="util_8cpp.html#a47aa45a9e2a816d5cf54a0173d4e786f">UtilVmWrite</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba377beaedc666fb495a5de99bff6667e9">VmcsField::kVmEntryIntrInfoField</a>, inject.<a class="code" href="union_vm_entry_interruption_information_field.html#a9ca137dd1b812d091ba9bc7b2f2f752d">all</a>);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      <a class="code" href="log_8h.html#aca3702a7bd5f85eb129bf7f3d77e3a32">HYPERPLATFORM_LOG_INFO_SAFE</a>(<span class="stringliteral">&quot;GuestRip= %p, #PF Fault= %p Code= 0x%2x&quot;</span>,</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                                  guest_context-&gt;<a class="code" href="struct_guest_context.html#abc69d3291f49cb0014a9b03f0e7fe57e">ip</a>, fault_address, fault_code);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (static_cast&lt;InterruptionVector&gt;(exception.<a class="code" href="union_vm_exit_interruption_information_field.html#a68bd7ad6a7be7847d637740d32902124">fields</a>.<a class="code" href="union_vm_exit_interruption_information_field.html#a05324c3bd75ef11750ed9a2f2db30b2e">vector</a>) ==</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;               <a class="code" href="ia32__type_8h.html#a09188c6f080645a99f9da56aa389ae10abaa21de466b1ec9be2567812eef7fa1f">InterruptionVector::kGeneralProtectionException</a>) {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <span class="comment">// # GP</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> error_code =</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;          <span class="keyword">static_cast&lt;</span>ULONG32<span class="keyword">&gt;</span>(<a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba9757b2880044df6a4ea8f05d5130af8a">VmcsField::kVmExitIntrErrorCode</a>));</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      <a class="code" href="union_vm_entry_interruption_information_field.html">VmEntryInterruptionInformationField</a> inject = {};</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      inject.<a class="code" href="union_vm_entry_interruption_information_field.html#a7240d1c95f4ec56ea07c470ccb5e7716">fields</a>.<a class="code" href="union_vm_entry_interruption_information_field.html#aa4708a2c6b44a05b9f05354626106b62">interruption_type</a> = exception.<a class="code" href="union_vm_exit_interruption_information_field.html#a68bd7ad6a7be7847d637740d32902124">fields</a>.<a class="code" href="union_vm_exit_interruption_information_field.html#afc0d177a9ebf865624eac98a3ea8367c">interruption_type</a>;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      inject.<a class="code" href="union_vm_entry_interruption_information_field.html#a7240d1c95f4ec56ea07c470ccb5e7716">fields</a>.<a class="code" href="union_vm_entry_interruption_information_field.html#aed60e16c758588e355861917f2a4f1d0">vector</a> = exception.<a class="code" href="union_vm_exit_interruption_information_field.html#a68bd7ad6a7be7847d637740d32902124">fields</a>.<a class="code" href="union_vm_exit_interruption_information_field.html#a05324c3bd75ef11750ed9a2f2db30b2e">vector</a>;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      inject.<a class="code" href="union_vm_entry_interruption_information_field.html#a7240d1c95f4ec56ea07c470ccb5e7716">fields</a>.<a class="code" href="union_vm_entry_interruption_information_field.html#afc19f2e9d19eb6880276bdb355d63119">deliver_error_code</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      inject.<a class="code" href="union_vm_entry_interruption_information_field.html#a7240d1c95f4ec56ea07c470ccb5e7716">fields</a>.<a class="code" href="union_vm_entry_interruption_information_field.html#a97f3a81fc1e370f877b35135a6fdad97">valid</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <a class="code" href="util_8cpp.html#a47aa45a9e2a816d5cf54a0173d4e786f">UtilVmWrite</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaa0e5b39f35a832fd9621f0bb57200d86">VmcsField::kVmEntryExceptionErrorCode</a>, error_code);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <a class="code" href="util_8cpp.html#a47aa45a9e2a816d5cf54a0173d4e786f">UtilVmWrite</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba377beaedc666fb495a5de99bff6667e9">VmcsField::kVmEntryIntrInfoField</a>, inject.<a class="code" href="union_vm_entry_interruption_information_field.html#a9ca137dd1b812d091ba9bc7b2f2f752d">all</a>);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <a class="code" href="log_8h.html#aca3702a7bd5f85eb129bf7f3d77e3a32">HYPERPLATFORM_LOG_INFO_SAFE</a>(<span class="stringliteral">&quot;GuestRip= %p, #GP Code= 0x%2x&quot;</span>,</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                                  guest_context-&gt;<a class="code" href="struct_guest_context.html#abc69d3291f49cb0014a9b03f0e7fe57e">ip</a>, error_code);</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      <a class="code" href="common_8h.html#a2fa75a42dd2f34590bed16f1583b2a9c">HYPERPLATFORM_COMMON_BUG_CHECK</a>(<a class="code" href="common_8h.html#a025de454ae4eec948d955fd67b2c1a47a25c2dc47991b3df171ed5192bcf70390">HyperPlatformBugCheck::kUnknown</a>, 0, 0, 0);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    }</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (static_cast&lt;interruption_type&gt;(</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                 exception.<a class="code" href="union_vm_exit_interruption_information_field.html#a68bd7ad6a7be7847d637740d32902124">fields</a>.<a class="code" href="union_vm_exit_interruption_information_field.html#afc0d177a9ebf865624eac98a3ea8367c">interruption_type</a>) ==</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;             <a class="code" href="ia32__type_8h.html#af02f226cd3a56b4fcc0a54efc9e89d68a19d6a5eed636ff60c09d352fb562d2ab">interruption_type::kSoftwareException</a>) {</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="comment">// Software exception</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">if</span> (static_cast&lt;InterruptionVector&gt;(exception.<a class="code" href="union_vm_exit_interruption_information_field.html#a68bd7ad6a7be7847d637740d32902124">fields</a>.<a class="code" href="union_vm_exit_interruption_information_field.html#a05324c3bd75ef11750ed9a2f2db30b2e">vector</a>) ==</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <a class="code" href="ia32__type_8h.html#a09188c6f080645a99f9da56aa389ae10a87c2fabd0645f060143339804f9731db">InterruptionVector::kBreakpointException</a>) {</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="comment">// #BP</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      <a class="code" href="union_vm_entry_interruption_information_field.html">VmEntryInterruptionInformationField</a> inject = {};</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      inject.<a class="code" href="union_vm_entry_interruption_information_field.html#a7240d1c95f4ec56ea07c470ccb5e7716">fields</a>.<a class="code" href="union_vm_entry_interruption_information_field.html#aa4708a2c6b44a05b9f05354626106b62">interruption_type</a> = exception.<a class="code" href="union_vm_exit_interruption_information_field.html#a68bd7ad6a7be7847d637740d32902124">fields</a>.<a class="code" href="union_vm_exit_interruption_information_field.html#afc0d177a9ebf865624eac98a3ea8367c">interruption_type</a>;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      inject.<a class="code" href="union_vm_entry_interruption_information_field.html#a7240d1c95f4ec56ea07c470ccb5e7716">fields</a>.<a class="code" href="union_vm_entry_interruption_information_field.html#aed60e16c758588e355861917f2a4f1d0">vector</a> = exception.<a class="code" href="union_vm_exit_interruption_information_field.html#a68bd7ad6a7be7847d637740d32902124">fields</a>.<a class="code" href="union_vm_exit_interruption_information_field.html#a05324c3bd75ef11750ed9a2f2db30b2e">vector</a>;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      inject.<a class="code" href="union_vm_entry_interruption_information_field.html#a7240d1c95f4ec56ea07c470ccb5e7716">fields</a>.<a class="code" href="union_vm_entry_interruption_information_field.html#afc19f2e9d19eb6880276bdb355d63119">deliver_error_code</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      inject.<a class="code" href="union_vm_entry_interruption_information_field.html#a7240d1c95f4ec56ea07c470ccb5e7716">fields</a>.<a class="code" href="union_vm_entry_interruption_information_field.html#a97f3a81fc1e370f877b35135a6fdad97">valid</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <a class="code" href="util_8cpp.html#a47aa45a9e2a816d5cf54a0173d4e786f">UtilVmWrite</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba377beaedc666fb495a5de99bff6667e9">VmcsField::kVmEntryIntrInfoField</a>, inject.<a class="code" href="union_vm_entry_interruption_information_field.html#a9ca137dd1b812d091ba9bc7b2f2f752d">all</a>);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <a class="code" href="util_8cpp.html#a47aa45a9e2a816d5cf54a0173d4e786f">UtilVmWrite</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbae159272ee4e15f08b504f4e80f7aa0e8">VmcsField::kVmEntryInstructionLen</a>, 1);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <a class="code" href="log_8h.html#aca3702a7bd5f85eb129bf7f3d77e3a32">HYPERPLATFORM_LOG_INFO_SAFE</a>(<span class="stringliteral">&quot;GuestRip= %p, #BP &quot;</span>, guest_context-&gt;<a class="code" href="struct_guest_context.html#abc69d3291f49cb0014a9b03f0e7fe57e">ip</a>);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      <a class="code" href="common_8h.html#a2fa75a42dd2f34590bed16f1583b2a9c">HYPERPLATFORM_COMMON_BUG_CHECK</a>(<a class="code" href="common_8h.html#a025de454ae4eec948d955fd67b2c1a47a25c2dc47991b3df171ed5192bcf70390">HyperPlatformBugCheck::kUnknown</a>, 0, 0, 0);</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <a class="code" href="common_8h.html#a2fa75a42dd2f34590bed16f1583b2a9c">HYPERPLATFORM_COMMON_BUG_CHECK</a>(<a class="code" href="common_8h.html#a025de454ae4eec948d955fd67b2c1a47a25c2dc47991b3df171ed5192bcf70390">HyperPlatformBugCheck::kUnknown</a>, 0, 0, 0);</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  }</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;}</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">// CPUID</span></div>
<div class="line"><a name="l00379"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#a6f3637ab3daeb3954bd70ec03122c81e">  379</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a7f4e7c5082162a3712e75eafecfd246f">VmmpHandleCpuid</a>(</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context) {</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <a class="code" href="performance_8h.html#a177eecc7a326a434e5c1667cc83a8f03">HYPERPLATFORM_PERFORMANCE_MEASURE_THIS_SCOPE</a>();</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cpu_info[4] = {};</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> function_id = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a896f0e1bdb321c03be37a22d5b0fa723">ax</a>);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> sub_function_id = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a87d569237c5526ffcf1ba68b29a152cb">cx</a>);</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="keywordflow">if</span> (function_id == 0 &amp;&amp; sub_function_id == <a class="code" href="vmm_8h.html#add3e29dd561f28c7f3ad0bfe070d807a">kHyperPlatformVmmBackdoorCode</a>) {</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="comment">// Say &quot;Pong by VMM!&quot; when the back-door code was given</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#ae2be97b70e97862689550d94ce1d7e04">bx</a> = <span class="stringliteral">&#39;gnoP&#39;</span>;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a8293b482ed199a0e71367cfb7ad82840">dx</a> = <span class="stringliteral">&#39; yb &#39;</span>;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a87d569237c5526ffcf1ba68b29a152cb">cx</a> = <span class="stringliteral">&#39;!MMV&#39;</span>;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    __cpuidex(reinterpret_cast&lt;int *&gt;(cpu_info), function_id, sub_function_id);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a896f0e1bdb321c03be37a22d5b0fa723">ax</a> = cpu_info[0];</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#ae2be97b70e97862689550d94ce1d7e04">bx</a> = cpu_info[1];</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a87d569237c5526ffcf1ba68b29a152cb">cx</a> = cpu_info[2];</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a8293b482ed199a0e71367cfb7ad82840">dx</a> = cpu_info[3];</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  }</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <a class="code" href="vmm_8cpp.html#a74d575262c9085bf28b9de246129c17e">VmmpAdjustGuestInstructionPointer</a>(guest_context-&gt;<a class="code" href="struct_guest_context.html#abc69d3291f49cb0014a9b03f0e7fe57e">ip</a>);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;}</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">// RDTSC</span></div>
<div class="line"><a name="l00403"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#a5545dcba470af6b0d2b1df73ec20e78e">  403</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a8c74dd7423915a0a5900fda92ea9f729">VmmpHandleRdtsc</a>(</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context) {</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  <a class="code" href="performance_8h.html#a177eecc7a326a434e5c1667cc83a8f03">HYPERPLATFORM_PERFORMANCE_MEASURE_THIS_SCOPE</a>();</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  ULARGE_INTEGER tsc = {};</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  tsc.QuadPart = __rdtsc();</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a8293b482ed199a0e71367cfb7ad82840">dx</a> = tsc.HighPart;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a896f0e1bdb321c03be37a22d5b0fa723">ax</a> = tsc.LowPart;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <a class="code" href="vmm_8cpp.html#a74d575262c9085bf28b9de246129c17e">VmmpAdjustGuestInstructionPointer</a>(guest_context-&gt;<a class="code" href="struct_guest_context.html#abc69d3291f49cb0014a9b03f0e7fe57e">ip</a>);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;}</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">// RDTSCP</span></div>
<div class="line"><a name="l00415"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#aa6ab4538d8e8d2719ce05661561d6375">  415</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a5a138d54b705286e8ebf2ae1c84763b9">VmmpHandleRdtscp</a>(</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context) {</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <a class="code" href="performance_8h.html#a177eecc7a326a434e5c1667cc83a8f03">HYPERPLATFORM_PERFORMANCE_MEASURE_THIS_SCOPE</a>();</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tsc_aux = 0;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  ULARGE_INTEGER tsc = {};</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  tsc.QuadPart = __rdtscp(&amp;tsc_aux);</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a8293b482ed199a0e71367cfb7ad82840">dx</a> = tsc.HighPart;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a896f0e1bdb321c03be37a22d5b0fa723">ax</a> = tsc.LowPart;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a87d569237c5526ffcf1ba68b29a152cb">cx</a> = tsc_aux;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <a class="code" href="vmm_8cpp.html#a74d575262c9085bf28b9de246129c17e">VmmpAdjustGuestInstructionPointer</a>(guest_context-&gt;<a class="code" href="struct_guest_context.html#abc69d3291f49cb0014a9b03f0e7fe57e">ip</a>);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;}</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">// XSETBV. It is executed at the time of system resuming</span></div>
<div class="line"><a name="l00429"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#aed97a39f5047e15f4f8845901b0db4cf">  429</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#aa7cfdb9078ff33633b0a2d00754b121f">VmmpHandleXsetbv</a>(</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context) {</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <a class="code" href="performance_8h.html#a177eecc7a326a434e5c1667cc83a8f03">HYPERPLATFORM_PERFORMANCE_MEASURE_THIS_SCOPE</a>();</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <a class="code" href="asm_8h.html#af23b5ae36ce1352e2bc5a9a0999e4cb2">AsmXsetbv</a>(static_cast&lt;ULONG&gt;(guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a87d569237c5526ffcf1ba68b29a152cb">cx</a>),</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            static_cast&lt;ULONG&gt;(guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a8293b482ed199a0e71367cfb7ad82840">dx</a>),</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            static_cast&lt;ULONG&gt;(guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a896f0e1bdb321c03be37a22d5b0fa723">ax</a>));</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <a class="code" href="vmm_8cpp.html#a74d575262c9085bf28b9de246129c17e">VmmpAdjustGuestInstructionPointer</a>(guest_context-&gt;<a class="code" href="struct_guest_context.html#abc69d3291f49cb0014a9b03f0e7fe57e">ip</a>);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;}</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">// RDMSR</span></div>
<div class="line"><a name="l00440"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#ad26cf18d5a6b8bed9388d7852543d1ed">  440</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a076579c5628cc2f15b0713f218cb6bed">VmmpHandleMsrReadAccess</a>(</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context) {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <a class="code" href="performance_8h.html#a177eecc7a326a434e5c1667cc83a8f03">HYPERPLATFORM_PERFORMANCE_MEASURE_THIS_SCOPE</a>();</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <a class="code" href="vmm_8cpp.html#ae335e24227daf5739435eeb6789142a6">VmmpHandleMsrAccess</a>(guest_context, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;}</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment">// WRMSR</span></div>
<div class="line"><a name="l00447"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#a3dab065cf0c4dc2a3da70c3ea4840e59">  447</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#aca9ba59e93c665bb5b0b0cb82696ad23">VmmpHandleMsrWriteAccess</a>(</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context) {</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <a class="code" href="performance_8h.html#a177eecc7a326a434e5c1667cc83a8f03">HYPERPLATFORM_PERFORMANCE_MEASURE_THIS_SCOPE</a>();</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <a class="code" href="vmm_8cpp.html#ae335e24227daf5739435eeb6789142a6">VmmpHandleMsrAccess</a>(guest_context, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;}</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">// RDMSR and WRMSR</span></div>
<div class="line"><a name="l00454"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#a4e2648ac690734fd8b65292b3345fef1">  454</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#ae335e24227daf5739435eeb6789142a6">VmmpHandleMsrAccess</a>(</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context, <span class="keywordtype">bool</span> read_access) {</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="comment">// Apply it for VMCS instead of a real MSR if a speficied MSR is either of</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="comment">// them.</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> msr = <span class="keyword">static_cast&lt;</span><a class="code" href="ia32__type_8h.html#a65b496b2a5595032807adc67e57e2e9e">Msr</a><span class="keyword">&gt;</span>(guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a87d569237c5526ffcf1ba68b29a152cb">cx</a>);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keywordtype">bool</span> transfer_to_vmcs = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cb">VmcsField</a> vmcs_field = {};</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keywordflow">switch</span> (msr) {</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a65b496b2a5595032807adc67e57e2e9eaeee8a9a34e97dd384dcff79576802fd5">Msr::kIa32SysenterCs</a>:</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      vmcs_field = <a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba6e92404f2eb70dfb318a45138afb4b1d">VmcsField::kGuestSysenterCs</a>;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      transfer_to_vmcs = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a65b496b2a5595032807adc67e57e2e9ea14ee780d4a4a917fac14fa94889096c5">Msr::kIa32SysenterEsp</a>:</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      vmcs_field = <a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba8887704debef8cf47a2771d2bcf35296">VmcsField::kGuestSysenterEsp</a>;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      transfer_to_vmcs = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a65b496b2a5595032807adc67e57e2e9ea154a6224d69f105f008d3eb91f88cf50">Msr::kIa32SysenterEip</a>:</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      vmcs_field = <a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba7e7fc2098784c31d10c0586c8fc2397f">VmcsField::kGuestSysenterEip</a>;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      transfer_to_vmcs = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a65b496b2a5595032807adc67e57e2e9ea266e45b2e9e260c75a7afaa15108fe0f">Msr::kIa32GsBase</a>:</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      vmcs_field = <a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbae789d67e4689a0374e52c9d826d3bb3b">VmcsField::kGuestGsBase</a>;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      transfer_to_vmcs = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a65b496b2a5595032807adc67e57e2e9ea165a59a3761aa65c1d58d404c5a56a92">Msr::kIa32FsBase</a>:</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      vmcs_field = <a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba698c331a2e83e54a458a82d454234cff">VmcsField::kGuestFsBase</a>;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  }</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="comment">// Do not shadow 64bit fields because the current implmentation for x86 is not</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="comment">// able to handle it due to a simple use of UtilVmWrite() below.</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  NT_ASSERT(<a class="code" href="util_8h.html#a131ab25ba676523d82ffa34bfba7f79d">UtilIsInBounds</a>(vmcs_field, <a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbac9775f4589417bca403533f54377bc84">VmcsField::kIoBitmapA</a>,</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                           <a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbabe340716829895c35bbd355a73204571">VmcsField::kHostIa32PerfGlobalCtrlHigh</a>) == <span class="keyword">false</span>);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  <span class="comment">// This unconditional __readmsr and __writemsr may cause #GP resulting in</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="comment">// bug check. A proper way to solve this is check supported MSR values</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <span class="comment">// beforehand and inject an exception when unsupported MSR values are given.</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  LARGE_INTEGER msr_value = {};</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="keywordflow">if</span> (read_access) {</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordflow">if</span> (transfer_to_vmcs) {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      msr_value.QuadPart = <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(vmcs_field);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      msr_value.QuadPart = <a class="code" href="util_8cpp.html#ae031e3644a8ebf1146b50ac00700b7a6">UtilReadMsr64</a>(msr);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    }</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a896f0e1bdb321c03be37a22d5b0fa723">ax</a> = msr_value.LowPart;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a8293b482ed199a0e71367cfb7ad82840">dx</a> = msr_value.HighPart;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    msr_value.LowPart = <span class="keyword">static_cast&lt;</span>ULONG<span class="keyword">&gt;</span>(guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a896f0e1bdb321c03be37a22d5b0fa723">ax</a>);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    msr_value.HighPart = <span class="keyword">static_cast&lt;</span>ULONG<span class="keyword">&gt;</span>(guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a8293b482ed199a0e71367cfb7ad82840">dx</a>);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keywordflow">if</span> (transfer_to_vmcs) {</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <a class="code" href="util_8cpp.html#a47aa45a9e2a816d5cf54a0173d4e786f">UtilVmWrite</a>(vmcs_field, static_cast&lt;ULONG_PTR&gt;(msr_value.QuadPart));</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      <a class="code" href="util_8cpp.html#a9a109dbda65e2c6345c933267f2fc260">UtilWriteMsr64</a>(msr, msr_value.QuadPart);</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    }</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  }</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  <a class="code" href="vmm_8cpp.html#a74d575262c9085bf28b9de246129c17e">VmmpAdjustGuestInstructionPointer</a>(guest_context-&gt;<a class="code" href="struct_guest_context.html#abc69d3291f49cb0014a9b03f0e7fe57e">ip</a>);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;}</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">// LIDT, SIDT, LGDT and SGDT</span></div>
<div class="line"><a name="l00516"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#a44b3407560964424607947c1c40dca48">  516</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a5287d4b4b503b93a18fa48277f365997">VmmpHandleGdtrOrIdtrAccess</a>(</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context) {</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <a class="code" href="performance_8h.html#a177eecc7a326a434e5c1667cc83a8f03">HYPERPLATFORM_PERFORMANCE_MEASURE_THIS_SCOPE</a>();</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <span class="keyword">const</span> <a class="code" href="union_gdtr_or_idtr_access_qualification.html">GdtrOrIdtrAccessQualification</a> exit_qualification = {</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      <span class="keyword">static_cast&lt;</span>ULONG32<span class="keyword">&gt;</span>(<a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba7a823dc9b77787fd973d184fcd05bc1b">VmcsField::kVmxInstructionInfo</a>))};</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <span class="comment">// Calculate an address to be used for the instruction</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> displacement = <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba7803322c278f9bbfe4ca10d4046b20d6">VmcsField::kExitQualification</a>);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="comment">// Base</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  ULONG_PTR base_value = 0;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="keywordflow">if</span> (!exit_qualification.<a class="code" href="union_gdtr_or_idtr_access_qualification.html#a4c48558ecf747d3fb1e6c99e84a01df4">fields</a>.<a class="code" href="union_gdtr_or_idtr_access_qualification.html#accdb0a994dd6875ac6b75556dc6156d1">base_register_invalid</a>) {</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> register_used = <a class="code" href="vmm_8cpp.html#a1c01a0073985999db6eaf5836fdaf56a">VmmpSelectRegister</a>(</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        exit_qualification.<a class="code" href="union_gdtr_or_idtr_access_qualification.html#a4c48558ecf747d3fb1e6c99e84a01df4">fields</a>.<a class="code" href="union_gdtr_or_idtr_access_qualification.html#aec56ad6f967b1bc16d6d1b5ba8d0d250">base_register</a>, guest_context);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    base_value = *register_used;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  }</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="comment">// Index</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  ULONG_PTR index_value = 0;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  <span class="keywordflow">if</span> (!exit_qualification.<a class="code" href="union_gdtr_or_idtr_access_qualification.html#a4c48558ecf747d3fb1e6c99e84a01df4">fields</a>.<a class="code" href="union_gdtr_or_idtr_access_qualification.html#a787c90522123daa00a4769a7b8a4cbf4">index_register_invalid</a>) {</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> register_used = <a class="code" href="vmm_8cpp.html#a1c01a0073985999db6eaf5836fdaf56a">VmmpSelectRegister</a>(</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        exit_qualification.<a class="code" href="union_gdtr_or_idtr_access_qualification.html#a4c48558ecf747d3fb1e6c99e84a01df4">fields</a>.<a class="code" href="union_gdtr_or_idtr_access_qualification.html#ac850f491220fd83527f4d8aad2dfaa9f">index_register</a>, guest_context);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    index_value = *register_used;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keywordflow">switch</span> (</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        static_cast&lt;GdtrOrIdtrScaling&gt;(exit_qualification.<a class="code" href="union_gdtr_or_idtr_access_qualification.html#a4c48558ecf747d3fb1e6c99e84a01df4">fields</a>.<a class="code" href="union_gdtr_or_idtr_access_qualification.html#aaff7ea2bf96c145ab9d5827fbe6e99fd">scalling</a>)) {</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a555d15179398f3cd5a63b13d997f9cbcace1c1c284858816e627d1dac60d368c3">GdtrOrIdtrScaling::kNoScaling</a>:</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        index_value = index_value;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a555d15179398f3cd5a63b13d997f9cbcaaad8e1a6ae2ec4d575688546345b84ca">GdtrOrIdtrScaling::kScaleBy2</a>:</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        index_value = index_value * 2;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a555d15179398f3cd5a63b13d997f9cbcadaaf08ec8a904bec532e8444ec0597e2">GdtrOrIdtrScaling::kScaleBy4</a>:</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        index_value = index_value * 4;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a555d15179398f3cd5a63b13d997f9cbca735c8b7ad0a957b6a3a162c379d07e0f">GdtrOrIdtrScaling::kScaleBy8</a>:</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        index_value = index_value * 8;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    }</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  }</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="keyword">auto</span> operation_address = base_value + index_value + displacement;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="keywordflow">if</span> (static_cast&lt;GdtrOrIdtrAaddressSize&gt;(</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;          exit_qualification.<a class="code" href="union_gdtr_or_idtr_access_qualification.html#a4c48558ecf747d3fb1e6c99e84a01df4">fields</a>.<a class="code" href="union_gdtr_or_idtr_access_qualification.html#aa680c63d80d53c640720c8f315472dd0">address_size</a>) ==</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <a class="code" href="ia32__type_8h.html#a22df35a31e9f08c48a653f5571e7e405aacd654b01c62015ead11357300c14b59">GdtrOrIdtrAaddressSize::k32bit</a>) {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    operation_address &amp;= MAXULONG;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  }</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="comment">// Update CR3 with that of the guest since below code is going to access</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="comment">// memory.</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> guest_cr3 = <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaff5d1adc02fe91c8b63f6c8a36229bcc">VmcsField::kGuestCr3</a>);</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> vmm_cr3 = __readcr3();</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  __writecr3(guest_cr3);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="comment">// Emulate the instruction</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  <span class="keyword">auto</span> descriptor_table_reg = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_idtr.html">Idtr</a> *<span class="keyword">&gt;</span>(operation_address);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <span class="keywordflow">switch</span> (static_cast&lt;GdtrOrIdtrInstructionIdentity&gt;(</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      exit_qualification.<a class="code" href="union_gdtr_or_idtr_access_qualification.html#a4c48558ecf747d3fb1e6c99e84a01df4">fields</a>.<a class="code" href="union_gdtr_or_idtr_access_qualification.html#a356bbcd26ac311ae5231010c07d8e469">instruction_identity</a>)) {</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a4147596d7b12d334d9a2f2a1ada16b3baff0261f43e297819cf727ff32bdc6de8">GdtrOrIdtrInstructionIdentity::kSgdt</a>:</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      descriptor_table_reg-&gt;base = <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba6ce8504584966b00c3171d153b69b7eb">VmcsField::kGuestGdtrBase</a>);</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      descriptor_table_reg-&gt;limit =</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;          <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">short</span><span class="keyword">&gt;</span>(<a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaeef5a1099a9158d515975aaf9f474918">VmcsField::kGuestGdtrLimit</a>));</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a4147596d7b12d334d9a2f2a1ada16b3ba7c13987389102119cbbdcf55f06dd04d">GdtrOrIdtrInstructionIdentity::kSidt</a>:</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      descriptor_table_reg-&gt;base = <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba2c1acaff8914b26a12d6c7c20360aed4">VmcsField::kGuestIdtrBase</a>);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      descriptor_table_reg-&gt;limit =</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;          <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">short</span><span class="keyword">&gt;</span>(<a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbac2061da2b42033870d7f40a5b528736a">VmcsField::kGuestIdtrLimit</a>));</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a4147596d7b12d334d9a2f2a1ada16b3bad33dbbeac5223ee6fe4ff14e2beea4fd">GdtrOrIdtrInstructionIdentity::kLgdt</a>:</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      <a class="code" href="util_8cpp.html#a47aa45a9e2a816d5cf54a0173d4e786f">UtilVmWrite</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba6ce8504584966b00c3171d153b69b7eb">VmcsField::kGuestGdtrBase</a>, descriptor_table_reg-&gt;base);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      <a class="code" href="util_8cpp.html#a47aa45a9e2a816d5cf54a0173d4e786f">UtilVmWrite</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaeef5a1099a9158d515975aaf9f474918">VmcsField::kGuestGdtrLimit</a>, descriptor_table_reg-&gt;limit);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a4147596d7b12d334d9a2f2a1ada16b3ba80e0a26060ce36afaaea7b43cde8ec2a">GdtrOrIdtrInstructionIdentity::kLidt</a>:</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      <a class="code" href="util_8cpp.html#a47aa45a9e2a816d5cf54a0173d4e786f">UtilVmWrite</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba2c1acaff8914b26a12d6c7c20360aed4">VmcsField::kGuestIdtrBase</a>, descriptor_table_reg-&gt;base);</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      <a class="code" href="util_8cpp.html#a47aa45a9e2a816d5cf54a0173d4e786f">UtilVmWrite</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbac2061da2b42033870d7f40a5b528736a">VmcsField::kGuestIdtrLimit</a>, descriptor_table_reg-&gt;limit);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  }</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  __writecr3(vmm_cr3);</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <a class="code" href="vmm_8cpp.html#a74d575262c9085bf28b9de246129c17e">VmmpAdjustGuestInstructionPointer</a>(guest_context-&gt;<a class="code" href="struct_guest_context.html#abc69d3291f49cb0014a9b03f0e7fe57e">ip</a>);</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;}</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">// LLDT, LTR, SLDT, and STR</span></div>
<div class="line"><a name="l00600"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#a17c50a69ea016af36beac73fdf58bad2">  600</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#aa5d99c76ea02860a68441b9f3a584178">VmmpHandleLdtrOrTrAccess</a>(</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context) {</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  <a class="code" href="performance_8h.html#a177eecc7a326a434e5c1667cc83a8f03">HYPERPLATFORM_PERFORMANCE_MEASURE_THIS_SCOPE</a>();</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  <span class="keyword">const</span> <a class="code" href="union_ldtr_or_tr_access_qualification.html">LdtrOrTrAccessQualification</a> exit_qualification = {</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <span class="keyword">static_cast&lt;</span>ULONG32<span class="keyword">&gt;</span>(<a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba7a823dc9b77787fd973d184fcd05bc1b">VmcsField::kVmxInstructionInfo</a>))};</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <span class="comment">// Calculate an address or a register to be used for the instruction</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> displacement = <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba7803322c278f9bbfe4ca10d4046b20d6">VmcsField::kExitQualification</a>);</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  ULONG_PTR operation_address = 0;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <span class="keywordflow">if</span> (exit_qualification.<a class="code" href="union_ldtr_or_tr_access_qualification.html#ac6754e5172725ae916f0d5289af6e196">fields</a>.<a class="code" href="union_ldtr_or_tr_access_qualification.html#a9e4144507a0ea640d3b1d94146c2ca5c">register_access</a>) {</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="comment">// Register</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> register_used =</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <a class="code" href="vmm_8cpp.html#a1c01a0073985999db6eaf5836fdaf56a">VmmpSelectRegister</a>(exit_qualification.<a class="code" href="union_ldtr_or_tr_access_qualification.html#ac6754e5172725ae916f0d5289af6e196">fields</a>.<a class="code" href="union_ldtr_or_tr_access_qualification.html#ac6fa2923a80016ca3ae735c2facdd106">register1</a>, guest_context);</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    operation_address = <span class="keyword">reinterpret_cast&lt;</span>ULONG_PTR<span class="keyword">&gt;</span>(register_used);</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="comment">// Base</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    ULONG_PTR base_value = 0;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keywordflow">if</span> (!exit_qualification.<a class="code" href="union_ldtr_or_tr_access_qualification.html#ac6754e5172725ae916f0d5289af6e196">fields</a>.<a class="code" href="union_ldtr_or_tr_access_qualification.html#aff8d0046aeb84c466a578f1abb620185">base_register_invalid</a>) {</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> register_used = <a class="code" href="vmm_8cpp.html#a1c01a0073985999db6eaf5836fdaf56a">VmmpSelectRegister</a>(</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;          exit_qualification.<a class="code" href="union_ldtr_or_tr_access_qualification.html#ac6754e5172725ae916f0d5289af6e196">fields</a>.<a class="code" href="union_ldtr_or_tr_access_qualification.html#acbb5f3b2ad2605ad837964656b55f8a4">base_register</a>, guest_context);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      base_value = *register_used;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    }</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="comment">// Index</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    ULONG_PTR index_value = 0;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="keywordflow">if</span> (!exit_qualification.<a class="code" href="union_ldtr_or_tr_access_qualification.html#ac6754e5172725ae916f0d5289af6e196">fields</a>.<a class="code" href="union_ldtr_or_tr_access_qualification.html#ac72397ee67a211e0f4caf8f2791cea0b">index_register_invalid</a>) {</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> register_used = <a class="code" href="vmm_8cpp.html#a1c01a0073985999db6eaf5836fdaf56a">VmmpSelectRegister</a>(</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;          exit_qualification.<a class="code" href="union_ldtr_or_tr_access_qualification.html#ac6754e5172725ae916f0d5289af6e196">fields</a>.<a class="code" href="union_ldtr_or_tr_access_qualification.html#a3e85f8c2d2399697d3dc8d2cd78754d7">index_register</a>, guest_context);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      index_value = *register_used;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <span class="keywordflow">switch</span> (</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;          static_cast&lt;GdtrOrIdtrScaling&gt;(exit_qualification.<a class="code" href="union_ldtr_or_tr_access_qualification.html#ac6754e5172725ae916f0d5289af6e196">fields</a>.<a class="code" href="union_ldtr_or_tr_access_qualification.html#a28e3a94d5d616bb1cbb0b5cefe539546">scalling</a>)) {</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a555d15179398f3cd5a63b13d997f9cbcace1c1c284858816e627d1dac60d368c3">GdtrOrIdtrScaling::kNoScaling</a>:</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;          index_value = index_value;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a555d15179398f3cd5a63b13d997f9cbcaaad8e1a6ae2ec4d575688546345b84ca">GdtrOrIdtrScaling::kScaleBy2</a>:</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;          index_value = index_value * 2;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a555d15179398f3cd5a63b13d997f9cbcadaaf08ec8a904bec532e8444ec0597e2">GdtrOrIdtrScaling::kScaleBy4</a>:</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;          index_value = index_value * 4;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a555d15179398f3cd5a63b13d997f9cbca735c8b7ad0a957b6a3a162c379d07e0f">GdtrOrIdtrScaling::kScaleBy8</a>:</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;          index_value = index_value * 8;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      }</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    }</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    operation_address = base_value + index_value + displacement;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordflow">if</span> (static_cast&lt;GdtrOrIdtrAaddressSize&gt;(</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            exit_qualification.<a class="code" href="union_ldtr_or_tr_access_qualification.html#ac6754e5172725ae916f0d5289af6e196">fields</a>.<a class="code" href="union_ldtr_or_tr_access_qualification.html#a6570958b95ef3acf34a621df47a24791">address_size</a>) ==</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <a class="code" href="ia32__type_8h.html#a22df35a31e9f08c48a653f5571e7e405aacd654b01c62015ead11357300c14b59">GdtrOrIdtrAaddressSize::k32bit</a>) {</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      operation_address &amp;= MAXULONG;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    }</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  }</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <span class="comment">// Update CR3 with that of the guest since below code is going to access</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  <span class="comment">// memory.</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> guest_cr3 = <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaff5d1adc02fe91c8b63f6c8a36229bcc">VmcsField::kGuestCr3</a>);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> vmm_cr3 = __readcr3();</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  __writecr3(guest_cr3);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="comment">// Emulate the instruction</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  <span class="keyword">auto</span> selector = <span class="keyword">reinterpret_cast&lt;</span>USHORT *<span class="keyword">&gt;</span>(operation_address);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  <span class="keywordflow">switch</span> (static_cast&lt;LdtrOrTrInstructionIdentity&gt;(</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      exit_qualification.<a class="code" href="union_ldtr_or_tr_access_qualification.html#ac6754e5172725ae916f0d5289af6e196">fields</a>.<a class="code" href="union_ldtr_or_tr_access_qualification.html#a2037b01950f861aa3acf8d26a6da7ea6">instruction_identity</a>)) {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ad7fa819ac11bf3c318c37fe162898ea9a9c0ea5013445ed4614482b090568f3a0">LdtrOrTrInstructionIdentity::kSldt</a>:</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      *selector =</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;          <span class="keyword">static_cast&lt;</span>USHORT<span class="keyword">&gt;</span>(<a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba19eab298a3aba40b9345084fd72e916c">VmcsField::kGuestLdtrSelector</a>));</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ad7fa819ac11bf3c318c37fe162898ea9ad27284bb9f714b7c386d36232f9b29be">LdtrOrTrInstructionIdentity::kStr</a>:</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      *selector = <span class="keyword">static_cast&lt;</span>USHORT<span class="keyword">&gt;</span>(<a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba502285fd8b67e2604115422d9d3759f2">VmcsField::kGuestTrSelector</a>));</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ad7fa819ac11bf3c318c37fe162898ea9ae82ac88caedfaddc8f1d0ecf27403562">LdtrOrTrInstructionIdentity::kLldt</a>:</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      <a class="code" href="util_8cpp.html#a47aa45a9e2a816d5cf54a0173d4e786f">UtilVmWrite</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba19eab298a3aba40b9345084fd72e916c">VmcsField::kGuestLdtrSelector</a>, *selector);</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#ad7fa819ac11bf3c318c37fe162898ea9a3bc953d1da4aa6ef5d81de282aa6f3d3">LdtrOrTrInstructionIdentity::kLtr</a>:</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <a class="code" href="util_8cpp.html#a47aa45a9e2a816d5cf54a0173d4e786f">UtilVmWrite</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba502285fd8b67e2604115422d9d3759f2">VmcsField::kGuestTrSelector</a>, *selector);</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  }</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  __writecr3(vmm_cr3);</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <a class="code" href="vmm_8cpp.html#a74d575262c9085bf28b9de246129c17e">VmmpAdjustGuestInstructionPointer</a>(guest_context-&gt;<a class="code" href="struct_guest_context.html#abc69d3291f49cb0014a9b03f0e7fe57e">ip</a>);</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;}</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment">// MOV to / from DRx</span></div>
<div class="line"><a name="l00687"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#ab6c87b60d5c701263b10ea747019e06b">  687</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#af96290550a514b6931f9eca8a3dda239">VmmpHandleDrAccess</a>(</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context) {</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <a class="code" href="performance_8h.html#a177eecc7a326a434e5c1667cc83a8f03">HYPERPLATFORM_PERFORMANCE_MEASURE_THIS_SCOPE</a>();</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  <span class="keyword">const</span> <a class="code" href="union_mov_dr_qualification.html">MovDrQualification</a> exit_qualification = {</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba7803322c278f9bbfe4ca10d4046b20d6">VmcsField::kExitQualification</a>)};</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> register_used =</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <a class="code" href="vmm_8cpp.html#a1c01a0073985999db6eaf5836fdaf56a">VmmpSelectRegister</a>(exit_qualification.<a class="code" href="union_mov_dr_qualification.html#a72c9ea745b7acc3fb72b78df3c330d10">fields</a>.<a class="code" href="union_mov_dr_qualification.html#a971347906624fa14f2247fb6ad2e7892">gp_register</a>, guest_context);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  <span class="comment">// Emulate the instruction</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <span class="keywordflow">switch</span> (static_cast&lt;MovDrDirection&gt;(exit_qualification.<a class="code" href="union_mov_dr_qualification.html#a72c9ea745b7acc3fb72b78df3c330d10">fields</a>.<a class="code" href="union_mov_dr_qualification.html#a6855204f5ea532a25e60c6a5b9d3be6d">direction</a>)) {</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a73982edbee1cbccffb602e32bc1c4f83a9221c07ae29d32b2539b85dd37bd9218">MovDrDirection::kMoveToDr</a>:</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      <span class="comment">// clang-format off</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      <span class="keywordflow">switch</span> (exit_qualification.<a class="code" href="union_mov_dr_qualification.html#a72c9ea745b7acc3fb72b78df3c330d10">fields</a>.<a class="code" href="union_mov_dr_qualification.html#af17242d4b8c914de52f8c65c20e6b1ba">debugl_register</a>) {</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        <span class="keywordflow">case</span> 0: __writedr(0, *register_used); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        <span class="keywordflow">case</span> 1: __writedr(1, *register_used); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        <span class="keywordflow">case</span> 2: __writedr(2, *register_used); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        <span class="keywordflow">case</span> 3: __writedr(3, *register_used); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        <span class="keywordflow">case</span> 4: __writedr(4, *register_used); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <span class="keywordflow">case</span> 5: __writedr(5, *register_used); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        <span class="keywordflow">case</span> 6: __writedr(6, *register_used); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        <span class="keywordflow">case</span> 7: __writedr(7, *register_used); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      }</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      <span class="comment">// clang-format on</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a73982edbee1cbccffb602e32bc1c4f83aa2f4f9c9ca65834f778e825f82304cc2">MovDrDirection::kMoveFromDr</a>:</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;      <span class="comment">// clang-format off</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;      <span class="keywordflow">switch</span> (exit_qualification.<a class="code" href="union_mov_dr_qualification.html#a72c9ea745b7acc3fb72b78df3c330d10">fields</a>.<a class="code" href="union_mov_dr_qualification.html#af17242d4b8c914de52f8c65c20e6b1ba">debugl_register</a>) {</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        <span class="keywordflow">case</span> 0: *register_used = __readdr(0); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        <span class="keywordflow">case</span> 1: *register_used = __readdr(1); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        <span class="keywordflow">case</span> 2: *register_used = __readdr(2); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        <span class="keywordflow">case</span> 3: *register_used = __readdr(3); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <span class="keywordflow">case</span> 4: *register_used = __readdr(4); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        <span class="keywordflow">case</span> 5: *register_used = __readdr(5); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <span class="keywordflow">case</span> 6: *register_used = __readdr(6); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <span class="keywordflow">case</span> 7: *register_used = __readdr(7); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      }</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      <span class="comment">// clang-format on</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;      <a class="code" href="common_8h.html#a2fa75a42dd2f34590bed16f1583b2a9c">HYPERPLATFORM_COMMON_BUG_CHECK</a>(<a class="code" href="common_8h.html#a025de454ae4eec948d955fd67b2c1a47a25c2dc47991b3df171ed5192bcf70390">HyperPlatformBugCheck::kUnknown</a>, 0, 0, 0);</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  }</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <a class="code" href="vmm_8cpp.html#a74d575262c9085bf28b9de246129c17e">VmmpAdjustGuestInstructionPointer</a>(guest_context-&gt;<a class="code" href="struct_guest_context.html#abc69d3291f49cb0014a9b03f0e7fe57e">ip</a>);</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;}</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment">// MOV to / from CRx</span></div>
<div class="line"><a name="l00736"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#a8fb9289d967c49d8900b22df4dc1911a">  736</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a9dd0aea373b81895ec20012fc9b1a546">VmmpHandleCrAccess</a>(</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context) {</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <a class="code" href="performance_8h.html#a177eecc7a326a434e5c1667cc83a8f03">HYPERPLATFORM_PERFORMANCE_MEASURE_THIS_SCOPE</a>();</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  <span class="keyword">const</span> <a class="code" href="union_mov_cr_qualification.html">MovCrQualification</a> exit_qualification = {</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba7803322c278f9bbfe4ca10d4046b20d6">VmcsField::kExitQualification</a>)};</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> register_used =</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      <a class="code" href="vmm_8cpp.html#a1c01a0073985999db6eaf5836fdaf56a">VmmpSelectRegister</a>(exit_qualification.<a class="code" href="union_mov_cr_qualification.html#a4b5c1fe45bcf20765e01f24a07dcc12a">fields</a>.<a class="code" href="union_mov_cr_qualification.html#aecc9e2003722e84dd082b9e2f477aed2">gp_register</a>, guest_context);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <span class="keywordflow">switch</span> (static_cast&lt;MovCrAccessType&gt;(exit_qualification.<a class="code" href="union_mov_cr_qualification.html#a4b5c1fe45bcf20765e01f24a07dcc12a">fields</a>.<a class="code" href="union_mov_cr_qualification.html#a1ce59f155a6b95debb3e74de31f8d39e">access_type</a>)) {</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a66faebb03d006844eb8f9306d9d438feaefa88228d54e52df93a22f69a1affd59">MovCrAccessType::kMoveToCr</a>: {</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      <span class="keywordflow">switch</span> (exit_qualification.<a class="code" href="union_mov_cr_qualification.html#a4b5c1fe45bcf20765e01f24a07dcc12a">fields</a>.<a class="code" href="union_mov_cr_qualification.html#a1b46fa366b68ad8aa8f3c8d47df5e3c2">control_register</a>) {</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <span class="comment">// CR0 &lt;- Reg</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="keywordflow">case</span> 0:</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="util_8cpp.html#ad8434ca108fb47650842faded523d9c4">UtilIsX86Pae</a>()) {</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            <a class="code" href="util_8cpp.html#a15f26bbfcd972225444b7a4736cb365c">UtilLoadPdptes</a>(<a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaff5d1adc02fe91c8b63f6c8a36229bcc">VmcsField::kGuestCr3</a>));</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;          }</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;          <a class="code" href="util_8cpp.html#a47aa45a9e2a816d5cf54a0173d4e786f">UtilVmWrite</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbae63ca17bd3a83436e7a268bcc689335f">VmcsField::kGuestCr0</a>, *register_used);</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;          <a class="code" href="util_8cpp.html#a47aa45a9e2a816d5cf54a0173d4e786f">UtilVmWrite</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbae5931e70f25d94616c727cce40d6b137">VmcsField::kCr0ReadShadow</a>, *register_used);</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        <span class="comment">// CR3 &lt;- Reg</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="util_8cpp.html#ad8434ca108fb47650842faded523d9c4">UtilIsX86Pae</a>()) {</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            <a class="code" href="util_8cpp.html#a15f26bbfcd972225444b7a4736cb365c">UtilLoadPdptes</a>(*register_used);</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;          }</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;          <a class="code" href="util_8cpp.html#a47aa45a9e2a816d5cf54a0173d4e786f">UtilVmWrite</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaff5d1adc02fe91c8b63f6c8a36229bcc">VmcsField::kGuestCr3</a>, *register_used);</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        <span class="comment">// CR4 &lt;- Reg</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        <span class="keywordflow">case</span> 4:</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="util_8cpp.html#ad8434ca108fb47650842faded523d9c4">UtilIsX86Pae</a>()) {</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            <a class="code" href="util_8cpp.html#a15f26bbfcd972225444b7a4736cb365c">UtilLoadPdptes</a>(<a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaff5d1adc02fe91c8b63f6c8a36229bcc">VmcsField::kGuestCr3</a>));</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;          }</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;          <a class="code" href="util_8cpp.html#a47aa45a9e2a816d5cf54a0173d4e786f">UtilVmWrite</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaa6dd29e51c781fd5c3c3737b4b4d935b">VmcsField::kGuestCr4</a>, *register_used);</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;          <a class="code" href="util_8cpp.html#a47aa45a9e2a816d5cf54a0173d4e786f">UtilVmWrite</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba405f81577cb4b6a3fc802546c3d9a8af">VmcsField::kCr4ReadShadow</a>, *register_used);</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        <span class="comment">// CR8 &lt;- Reg</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        <span class="keywordflow">case</span> 8:</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;          guest_context-&gt;<a class="code" href="struct_guest_context.html#a119437e05b54a8082c042df7df80d320">cr8</a> = *register_used;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;          <a class="code" href="common_8h.html#a2fa75a42dd2f34590bed16f1583b2a9c">HYPERPLATFORM_COMMON_BUG_CHECK</a>(<a class="code" href="common_8h.html#a025de454ae4eec948d955fd67b2c1a47a25c2dc47991b3df171ed5192bcf70390">HyperPlatformBugCheck::kUnknown</a>, 0, 0,</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                                         0);</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      }</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    } <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="comment">// Note that MOV from CRx should never cause VM-exit with the current</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="comment">// settings. This is just for case when you enable it.</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a66faebb03d006844eb8f9306d9d438fea02e3317fda681e9cd1d7514e6d265f93">MovCrAccessType::kMoveFromCr</a>: {</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      <span class="keywordflow">switch</span> (exit_qualification.<a class="code" href="union_mov_cr_qualification.html#a4b5c1fe45bcf20765e01f24a07dcc12a">fields</a>.<a class="code" href="union_mov_cr_qualification.html#a1b46fa366b68ad8aa8f3c8d47df5e3c2">control_register</a>) {</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        <span class="comment">// Reg &lt;- CR3</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;          *register_used = <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaff5d1adc02fe91c8b63f6c8a36229bcc">VmcsField::kGuestCr3</a>);</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="comment">// Reg &lt;- CR8</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        <span class="keywordflow">case</span> 8:</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;          *register_used = guest_context-&gt;<a class="code" href="struct_guest_context.html#a119437e05b54a8082c042df7df80d320">cr8</a>;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;          <a class="code" href="common_8h.html#a2fa75a42dd2f34590bed16f1583b2a9c">HYPERPLATFORM_COMMON_BUG_CHECK</a>(<a class="code" href="common_8h.html#a025de454ae4eec948d955fd67b2c1a47a25c2dc47991b3df171ed5192bcf70390">HyperPlatformBugCheck::kUnknown</a>, 0, 0,</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                                         0);</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;      }</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    } <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="comment">// Unimplemented</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a66faebb03d006844eb8f9306d9d438feab0e93ecf521b9cad7e7b7bcaf49a591b">MovCrAccessType::kClts</a>:</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ia32__type_8h.html#a66faebb03d006844eb8f9306d9d438fea666b7de6fe17990c0cbde37dd28fb9e0">MovCrAccessType::kLmsw</a>:</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;      <a class="code" href="common_8h.html#ab555eaf608d224d2229f6bdd726ab95b">HYPERPLATFORM_COMMON_DBG_BREAK</a>();</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  }</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  <a class="code" href="vmm_8cpp.html#a74d575262c9085bf28b9de246129c17e">VmmpAdjustGuestInstructionPointer</a>(guest_context-&gt;<a class="code" href="struct_guest_context.html#abc69d3291f49cb0014a9b03f0e7fe57e">ip</a>);</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;}</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="comment">// VMX instructions except for VMCALL</span></div>
<div class="line"><a name="l00819"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#a9af723856b3cb3ae90030292d1dcf453">  819</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a7889383e3e67c7507cde12bd68c0edd3">VmmpHandleVmx</a>(<a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context) {</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  <a class="code" href="performance_8h.html#a177eecc7a326a434e5c1667cc83a8f03">HYPERPLATFORM_PERFORMANCE_MEASURE_THIS_SCOPE</a>();</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;  guest_context-&gt;<a class="code" href="struct_guest_context.html#a387d47754ddefc13d947494ac049d9e8">flag_reg</a>.<a class="code" href="union_flag_register.html#a5c93781864e367ede0b0b0a44d0af4ca">fields</a>.<a class="code" href="union_flag_register.html#aecf8883866e35dc3eeffb2751b47ae08">cf</a> = <span class="keyword">true</span>;  <span class="comment">// Error without status</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  guest_context-&gt;<a class="code" href="struct_guest_context.html#a387d47754ddefc13d947494ac049d9e8">flag_reg</a>.<a class="code" href="union_flag_register.html#a5c93781864e367ede0b0b0a44d0af4ca">fields</a>.<a class="code" href="union_flag_register.html#a3f12edac6aebefb797ca15ad95e99eaf">pf</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  guest_context-&gt;<a class="code" href="struct_guest_context.html#a387d47754ddefc13d947494ac049d9e8">flag_reg</a>.<a class="code" href="union_flag_register.html#a5c93781864e367ede0b0b0a44d0af4ca">fields</a>.<a class="code" href="union_flag_register.html#a1703c783f80d99158cd31de0affa3931">af</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  guest_context-&gt;<a class="code" href="struct_guest_context.html#a387d47754ddefc13d947494ac049d9e8">flag_reg</a>.<a class="code" href="union_flag_register.html#a5c93781864e367ede0b0b0a44d0af4ca">fields</a>.<a class="code" href="union_flag_register.html#a114d38566bd64e42dd4a4631f97fc672">zf</a> = <span class="keyword">false</span>;  <span class="comment">// Error without status</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  guest_context-&gt;<a class="code" href="struct_guest_context.html#a387d47754ddefc13d947494ac049d9e8">flag_reg</a>.<a class="code" href="union_flag_register.html#a5c93781864e367ede0b0b0a44d0af4ca">fields</a>.<a class="code" href="union_flag_register.html#a8b11871d0be1bf711079fbd8c73c5f18">sf</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  guest_context-&gt;<a class="code" href="struct_guest_context.html#a387d47754ddefc13d947494ac049d9e8">flag_reg</a>.<a class="code" href="union_flag_register.html#a5c93781864e367ede0b0b0a44d0af4ca">fields</a>.<a class="code" href="union_flag_register.html#a591a5bf75301f1d91de07a1bbad83d78">of</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  <a class="code" href="util_8cpp.html#a47aa45a9e2a816d5cf54a0173d4e786f">UtilVmWrite</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba7c4ad323abdb427c1cee8152c50a2953">VmcsField::kGuestRflags</a>, guest_context-&gt;<a class="code" href="struct_guest_context.html#a387d47754ddefc13d947494ac049d9e8">flag_reg</a>.<a class="code" href="union_flag_register.html#a162a6e44378f3cc0e9f569451e808542">all</a>);</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  <a class="code" href="vmm_8cpp.html#a74d575262c9085bf28b9de246129c17e">VmmpAdjustGuestInstructionPointer</a>(guest_context-&gt;<a class="code" href="struct_guest_context.html#abc69d3291f49cb0014a9b03f0e7fe57e">ip</a>);</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;}</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="comment">// VMCALL</span></div>
<div class="line"><a name="l00832"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#aa8b54d75cffd4fdeccdd215427e42e9c">  832</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a0c35206d6bd25f8caa79ab139ff725a5">VmmpHandleVmCall</a>(</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context) {</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  <span class="comment">// VMCALL for Sushi expects that cx holds a command number, and dx holds an</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  <span class="comment">// address of a context parameter optionally</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> hypercall_number = guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a87d569237c5526ffcf1ba68b29a152cb">cx</a>;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> context = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span> *<span class="keyword">&gt;</span>(guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a8293b482ed199a0e71367cfb7ad82840">dx</a>);</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  <span class="keywordflow">if</span> (hypercall_number == <a class="code" href="vmm_8h.html#add3e29dd561f28c7f3ad0bfe070d807a">kHyperPlatformVmmBackdoorCode</a>) {</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="comment">// Unloading requested</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <a class="code" href="common_8h.html#ab555eaf608d224d2229f6bdd726ab95b">HYPERPLATFORM_COMMON_DBG_BREAK</a>();</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="comment">// The processor sets ffff to limits of IDT and GDT when VM-exit occurred.</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <span class="comment">// It is not correct value but fine to ignore since vmresume loads correct</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="comment">// values from VMCS. But here, we are going to skip vmresume and simply</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="comment">// return to where VMCALL is executed. It results in keeping those broken</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <span class="comment">// values and ends up with bug check 109, so we should fix them manually.</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> gdt_limit = <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaeef5a1099a9158d515975aaf9f474918">VmcsField::kGuestGdtrLimit</a>);</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> gdt_base = <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba6ce8504584966b00c3171d153b69b7eb">VmcsField::kGuestGdtrBase</a>);</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> idt_limit = <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbac2061da2b42033870d7f40a5b528736a">VmcsField::kGuestIdtrLimit</a>);</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> idt_base = <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba2c1acaff8914b26a12d6c7c20360aed4">VmcsField::kGuestIdtrBase</a>);</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <a class="code" href="struct_idtr.html">Gdtr</a> gdtr = {<span class="keyword">static_cast&lt;</span>USHORT<span class="keyword">&gt;</span>(gdt_limit), gdt_base};</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <a class="code" href="struct_idtr.html">Idtr</a> idtr = {<span class="keyword">static_cast&lt;</span>USHORT<span class="keyword">&gt;</span>(idt_limit), idt_base};</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <a class="code" href="asm_8h.html#a0e87423ee42eebf6a70fc1d75d71d0f5">__lgdt</a>(&amp;gdtr);</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    __lidt(&amp;idtr);</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <span class="comment">// Store an address of the management structure to the context parameter</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> result_ptr = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_processor_data.html">ProcessorData</a> **<span class="keyword">&gt;</span>(context);</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    *result_ptr = guest_context-&gt;<a class="code" href="struct_guest_context.html#a5137680c60d5726f6cec0e925d9b25b1">stack</a>-&gt;<a class="code" href="struct_vmm_initial_stack.html#a6470c7e65bd6a19c2afa6220943f38e1">processor_data</a>;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <a class="code" href="log_8h.html#a66562e80938c3116822fc8f72adaf24c">HYPERPLATFORM_LOG_DEBUG_SAFE</a>(<span class="stringliteral">&quot;Context at %p %p&quot;</span>, context,</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                                 guest_context-&gt;<a class="code" href="struct_guest_context.html#a5137680c60d5726f6cec0e925d9b25b1">stack</a>-&gt;<a class="code" href="struct_vmm_initial_stack.html#a6470c7e65bd6a19c2afa6220943f38e1">processor_data</a>);</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="comment">// Set rip to the next instruction of VMCALL</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> exit_instruction_length =</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba7c38d39e9c12bd7b1df0cfac168cafa1">VmcsField::kVmExitInstructionLen</a>);</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> return_address = guest_context-&gt;<a class="code" href="struct_guest_context.html#abc69d3291f49cb0014a9b03f0e7fe57e">ip</a> + exit_instruction_length;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <span class="comment">// Since rflags is overwritten after VMXOFF, we should manually indicates</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <span class="comment">// that VMCALL was successful by clearing those flags.</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    guest_context-&gt;<a class="code" href="struct_guest_context.html#a387d47754ddefc13d947494ac049d9e8">flag_reg</a>.<a class="code" href="union_flag_register.html#a5c93781864e367ede0b0b0a44d0af4ca">fields</a>.<a class="code" href="union_flag_register.html#aecf8883866e35dc3eeffb2751b47ae08">cf</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    guest_context-&gt;<a class="code" href="struct_guest_context.html#a387d47754ddefc13d947494ac049d9e8">flag_reg</a>.<a class="code" href="union_flag_register.html#a5c93781864e367ede0b0b0a44d0af4ca">fields</a>.<a class="code" href="union_flag_register.html#a114d38566bd64e42dd4a4631f97fc672">zf</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="comment">// Set registers used after VMXOFF to recover the context. Volatile</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    <span class="comment">// registers must be used because those changes are reflected to the</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="comment">// guest&#39;s context after VMXOFF.</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a87d569237c5526ffcf1ba68b29a152cb">cx</a> = return_address;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a8293b482ed199a0e71367cfb7ad82840">dx</a> = guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a01ff4b8d095922bbe45840bf2192c361">sp</a>;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a896f0e1bdb321c03be37a22d5b0fa723">ax</a> = guest_context-&gt;<a class="code" href="struct_guest_context.html#a387d47754ddefc13d947494ac049d9e8">flag_reg</a>.<a class="code" href="union_flag_register.html#a162a6e44378f3cc0e9f569451e808542">all</a>;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    guest_context-&gt;<a class="code" href="struct_guest_context.html#ad5fde384d1b94f80cec6f1ffa0f2327c">vm_continue</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <a class="code" href="util_8cpp.html#a26380029ce6cda809af3b6794674debd">UtilInveptAll</a>();</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="comment">// Unsupported hypercall. Handle like other VMX instructions</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <a class="code" href="vmm_8cpp.html#a7889383e3e67c7507cde12bd68c0edd3">VmmpHandleVmx</a>(guest_context);</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  }</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;}</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="comment">// INVD</span></div>
<div class="line"><a name="l00890"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#a94765d762562b7d66d32b70ab36ef66c">  890</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a25ec906723d7f199fc49a820cfcb1e8c">VmmpHandleInvalidateInternalCaches</a>(</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context) {</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <a class="code" href="performance_8h.html#a177eecc7a326a434e5c1667cc83a8f03">HYPERPLATFORM_PERFORMANCE_MEASURE_THIS_SCOPE</a>();</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  <a class="code" href="asm_8h.html#aebe13d56500a53aae4de580a01a8f61f">AsmInvalidateInternalCaches</a>();</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <a class="code" href="vmm_8cpp.html#a74d575262c9085bf28b9de246129c17e">VmmpAdjustGuestInstructionPointer</a>(guest_context-&gt;<a class="code" href="struct_guest_context.html#abc69d3291f49cb0014a9b03f0e7fe57e">ip</a>);</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;}</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="comment">// INVLPG</span></div>
<div class="line"><a name="l00898"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#a78c798583cd8bf076b2b545f57e881cc">  898</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#ad2045ccea55ea3345f22cdb7e2a9a6ba">VmmpHandleInvalidateTLBEntry</a>(</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context) {</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  <a class="code" href="performance_8h.html#a177eecc7a326a434e5c1667cc83a8f03">HYPERPLATFORM_PERFORMANCE_MEASURE_THIS_SCOPE</a>();</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> invalidate_address =</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      <span class="keyword">static_cast&lt;</span>ULONG_PTR<span class="keyword">&gt;</span>(<a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba7803322c278f9bbfe4ca10d4046b20d6">VmcsField::kExitQualification</a>));</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  <a class="code" href="asm_8h.html#a79db6c3a490dc84acfe8ba14268131b8">AsmInvlpg</a>(invalidate_address);</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <a class="code" href="vmm_8cpp.html#a74d575262c9085bf28b9de246129c17e">VmmpAdjustGuestInstructionPointer</a>(guest_context-&gt;<a class="code" href="struct_guest_context.html#abc69d3291f49cb0014a9b03f0e7fe57e">ip</a>);</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;}</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="comment">// EXIT_REASON_EPT_VIOLATION</span></div>
<div class="line"><a name="l00908"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#a572fdc29d1553bb115a734013c9d8df3">  908</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a3a8844706155374466e6af3d451ab567">VmmpHandleEptViolation</a>(</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context) {</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  <a class="code" href="performance_8h.html#a177eecc7a326a434e5c1667cc83a8f03">HYPERPLATFORM_PERFORMANCE_MEASURE_THIS_SCOPE</a>();</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  <a class="code" href="ept_8cpp.html#a6adf0f9672ecc2605b2e73a3dea55468">EptHandleEptViolation</a>(</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      guest_context-&gt;<a class="code" href="struct_guest_context.html#a5137680c60d5726f6cec0e925d9b25b1">stack</a>-&gt;<a class="code" href="struct_vmm_initial_stack.html#a6470c7e65bd6a19c2afa6220943f38e1">processor_data</a>-&gt;<a class="code" href="struct_processor_data.html#aacd3c5235d2d598f119585f3aa77d68b">shared_data</a>-&gt;<a class="code" href="struct_shared_processor_data.html#a6f7691959781f3a51651136d5419b9cb">ept_data</a>);</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;}</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="comment">// EXIT_REASON_EPT_MISCONFIG</span></div>
<div class="line"><a name="l00916"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#a902093a32ce5b78000294b7a9bd5d048">  916</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a5a9b39b7dbbe8954e087bb61db6be81c">VmmpHandleEptMisconfig</a>(</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context) {</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  UNREFERENCED_PARAMETER(guest_context);</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> fault_address = <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba54ec8cb69b3a6f7caa8978cc6cb3e7d5">VmcsField::kGuestPhysicalAddress</a>);</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  UNREFERENCED_PARAMETER(fault_address);</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  <a class="code" href="common_8h.html#ab555eaf608d224d2229f6bdd726ab95b">HYPERPLATFORM_COMMON_DBG_BREAK</a>();</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;}</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="comment">// Selects a register to be used based on the index</span></div>
<div class="line"><a name="l00926"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#a48572e228638b1d562a032ef32e12aa4">  926</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> ULONG_PTR *<a class="code" href="vmm_8cpp.html#a1c01a0073985999db6eaf5836fdaf56a">VmmpSelectRegister</a>(</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    ULONG index, <a class="code" href="struct_guest_context.html">GuestContext</a> *guest_context) {</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  ULONG_PTR *register_used = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  <span class="comment">// clang-format off</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  <span class="keywordflow">switch</span> (index) {</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="keywordflow">case</span> 0: register_used = &amp;guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a896f0e1bdb321c03be37a22d5b0fa723">ax</a>; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="keywordflow">case</span> 1: register_used = &amp;guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a87d569237c5526ffcf1ba68b29a152cb">cx</a>; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <span class="keywordflow">case</span> 2: register_used = &amp;guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a8293b482ed199a0e71367cfb7ad82840">dx</a>; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="keywordflow">case</span> 3: register_used = &amp;guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#ae2be97b70e97862689550d94ce1d7e04">bx</a>; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="keywordflow">case</span> 4: register_used = &amp;guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a01ff4b8d095922bbe45840bf2192c361">sp</a>; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="keywordflow">case</span> 5: register_used = &amp;guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#abca0e685f3512da486bbbac8fab0e661">bp</a>; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="keywordflow">case</span> 6: register_used = &amp;guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a65fe3207c077d33af10061a151761368">si</a>; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    <span class="keywordflow">case</span> 7: register_used = &amp;guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;<a class="code" href="struct_gp_registers_x86.html#a85d9a723e3edf9d1bc3f9cd1a977b7ee">di</a>; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="preprocessor">#if defined(_AMD64_)</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="keywordflow">case</span> 8: register_used = &amp;guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;r8; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="keywordflow">case</span> 9: register_used = &amp;guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;r9; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="keywordflow">case</span> 10: register_used = &amp;guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;r10; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="keywordflow">case</span> 11: register_used = &amp;guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;r11; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="keywordflow">case</span> 12: register_used = &amp;guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;r12; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    <span class="keywordflow">case</span> 13: register_used = &amp;guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;r13; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keywordflow">case</span> 14: register_used = &amp;guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;r14; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    <span class="keywordflow">case</span> 15: register_used = &amp;guest_context-&gt;<a class="code" href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">gp_regs</a>-&gt;r15; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <span class="keywordflow">default</span>: <a class="code" href="common_8h.html#ab555eaf608d224d2229f6bdd726ab95b">HYPERPLATFORM_COMMON_DBG_BREAK</a>(); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  }</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <span class="comment">// clang-format on</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  <span class="keywordflow">return</span> register_used;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;}</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="comment">// Dumps guest&#39;s selectors</span></div>
<div class="line"><a name="l00956"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#a558ceb9b748edc1d0d0a881d98ebc62b">  956</a></span>&#160;<span class="comment">/*_Use_decl_annotations_*/</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a558ceb9b748edc1d0d0a881d98ebc62b">VmmpDumpGuestSelectors</a>() {</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <a class="code" href="log_8h.html#a66562e80938c3116822fc8f72adaf24c">HYPERPLATFORM_LOG_DEBUG_SAFE</a>(</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;      <span class="stringliteral">&quot;es %04x %p %08x %08x&quot;</span>, <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaf71cd127152a3b0c394b8269428b271a">VmcsField::kGuestEsSelector</a>),</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;      <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaad7582d0322aa73fa721b7119125214f">VmcsField::kGuestEsBase</a>), <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba301858c51fa8d6d9bc596974f75db658">VmcsField::kGuestEsLimit</a>),</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba1824c10f908c38a703b5321d379e1aa7">VmcsField::kGuestEsArBytes</a>));</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  <a class="code" href="log_8h.html#a66562e80938c3116822fc8f72adaf24c">HYPERPLATFORM_LOG_DEBUG_SAFE</a>(</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;      <span class="stringliteral">&quot;cs %04x %p %08x %08x&quot;</span>, <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbae751115f33e5898d215ddfd370a8c5a2">VmcsField::kGuestCsSelector</a>),</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;      <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaa3fe77bd1848081d4791d1b8802e0a06">VmcsField::kGuestCsBase</a>), <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbac69642662e350c572b949d8715094864">VmcsField::kGuestCsLimit</a>),</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;      <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba629b80e522cc8573429756431d936ba2">VmcsField::kGuestCsArBytes</a>));</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <a class="code" href="log_8h.html#a66562e80938c3116822fc8f72adaf24c">HYPERPLATFORM_LOG_DEBUG_SAFE</a>(</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;      <span class="stringliteral">&quot;ss %04x %p %08x %08x&quot;</span>, <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba589e19bdb7501ceabce9894ce2208652">VmcsField::kGuestSsSelector</a>),</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;      <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba56a28a031f551cd3eb18ca1054176819">VmcsField::kGuestSsBase</a>), <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba08ff5cc964d68afb3830d42f5fb0ac06">VmcsField::kGuestSsLimit</a>),</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbab4167c78657b243b30d1c83c599f5449">VmcsField::kGuestSsArBytes</a>));</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  <a class="code" href="log_8h.html#a66562e80938c3116822fc8f72adaf24c">HYPERPLATFORM_LOG_DEBUG_SAFE</a>(</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      <span class="stringliteral">&quot;ds %04x %p %08x %08x&quot;</span>, <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba2fe1631936f4c6b1c82e46dd3b134eac">VmcsField::kGuestDsSelector</a>),</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;      <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba79885d1b8f0d3694a6180af35ed0ffe3">VmcsField::kGuestDsBase</a>), <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaab62caa0bfded08705282b36b37c68fa">VmcsField::kGuestDsLimit</a>),</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;      <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba5bfa8783bd0d0f214b27f25484510ac0">VmcsField::kGuestDsArBytes</a>));</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <a class="code" href="log_8h.html#a66562e80938c3116822fc8f72adaf24c">HYPERPLATFORM_LOG_DEBUG_SAFE</a>(</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      <span class="stringliteral">&quot;fs %04x %p %08x %08x&quot;</span>, <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba9a8878cb4a8fb3efb11cc1b48d11fd67">VmcsField::kGuestFsSelector</a>),</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba698c331a2e83e54a458a82d454234cff">VmcsField::kGuestFsBase</a>), <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbad109d64606d00d8a78a89fd4917a0d40">VmcsField::kGuestFsLimit</a>),</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbac061aa91d11e4172ad791ee06c867648">VmcsField::kGuestFsArBytes</a>));</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  <a class="code" href="log_8h.html#a66562e80938c3116822fc8f72adaf24c">HYPERPLATFORM_LOG_DEBUG_SAFE</a>(</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      <span class="stringliteral">&quot;gs %04x %p %08x %08x&quot;</span>, <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbadc13324fa79ae10691ffe34828ac907d">VmcsField::kGuestGsSelector</a>),</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbae789d67e4689a0374e52c9d826d3bb3b">VmcsField::kGuestGsBase</a>), <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba0cd2a9e3f9188694e265f957d4db2cb0">VmcsField::kGuestGsLimit</a>),</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;      <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba3306c9c3f43fc098d171942dc3cef570">VmcsField::kGuestGsArBytes</a>));</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  <a class="code" href="log_8h.html#a66562e80938c3116822fc8f72adaf24c">HYPERPLATFORM_LOG_DEBUG_SAFE</a>(<span class="stringliteral">&quot;ld %04x %p %08x %08x&quot;</span>,</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;                               <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba19eab298a3aba40b9345084fd72e916c">VmcsField::kGuestLdtrSelector</a>),</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;                               <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba9e03ba9dfed3f51a2363504c338eea21">VmcsField::kGuestLdtrBase</a>),</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;                               <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaf7614f4dd86fff020ebf1cd7631aeb26">VmcsField::kGuestLdtrLimit</a>),</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;                               <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba841afcc77157df576377fa5cb30936b7">VmcsField::kGuestLdtrArBytes</a>));</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  <a class="code" href="log_8h.html#a66562e80938c3116822fc8f72adaf24c">HYPERPLATFORM_LOG_DEBUG_SAFE</a>(</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;      <span class="stringliteral">&quot;tr %04x %p %08x %08x&quot;</span>, <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba502285fd8b67e2604115422d9d3759f2">VmcsField::kGuestTrSelector</a>),</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;      <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbad708a22ea3cc689e34d77901b79a83fc">VmcsField::kGuestTrBase</a>), <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbafcca9ad8e93010093cc770d18499b840">VmcsField::kGuestTrLimit</a>),</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbacf4a77606486bce3eba145b38653cc5f">VmcsField::kGuestTrArBytes</a>));</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;}</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="comment">// Sets rip to the next instruction</span></div>
<div class="line"><a name="l00993"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#a910314fd25b27826cfa67a298426f0c6">  993</a></span>&#160;_Use_decl_annotations_ <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vmm_8cpp.html#a74d575262c9085bf28b9de246129c17e">VmmpAdjustGuestInstructionPointer</a>(</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    ULONG_PTR guest_ip) {</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> exit_instruction_length =</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba7c38d39e9c12bd7b1df0cfac168cafa1">VmcsField::kVmExitInstructionLen</a>);</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <a class="code" href="util_8cpp.html#a47aa45a9e2a816d5cf54a0173d4e786f">UtilVmWrite</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba73fa622f28ef655069a049bbeb89fbdf">VmcsField::kGuestRip</a>, guest_ip + exit_instruction_length);</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;}</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="comment">// Handle VMRESUME or VMXOFF failure. Fatal error.</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"><a class="line" href="vmm_8cpp.html#a6ced73bfff78fd28cadca5fc03620d0a"> 1001</a></span>&#160;_Use_decl_annotations_ <span class="keywordtype">void</span> __stdcall <a class="code" href="vmm_8cpp.html#ab949fa6efd53abc611bcfa0e41e20cf0">VmmVmxFailureHandler</a>(</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    <a class="code" href="struct_all_registers.html">AllRegisters</a> *all_regs) {</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> vmx_error = (all_regs-&gt;<a class="code" href="struct_all_registers.html#a71178c6ec16f6e39a2d102b438315d5f">flags</a>.<a class="code" href="union_flag_register.html#a5c93781864e367ede0b0b0a44d0af4ca">fields</a>.<a class="code" href="union_flag_register.html#a114d38566bd64e42dd4a4631f97fc672">zf</a>)</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                             ? <a class="code" href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a>(<a class="code" href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba42d029a82770b0ea7a690f215bb388ad">VmcsField::kVmInstructionError</a>)</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;                             : 0;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <a class="code" href="common_8h.html#a2fa75a42dd2f34590bed16f1583b2a9c">HYPERPLATFORM_COMMON_BUG_CHECK</a>(</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;      <a class="code" href="common_8h.html#a025de454ae4eec948d955fd67b2c1a47adb2cba8af01b74b26ce9d8b049122174">HyperPlatformBugCheck::kCriticalVmxInstructionFailure</a>, vmx_error, 0, 0);</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;}</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;}  <span class="comment">// extern &quot;C&quot;</span></div>
<div class="ttc" id="common_8h_html_a025de454ae4eec948d955fd67b2c1a47af882ecbdd08f4b410b82ca4894208040"><div class="ttname"><a href="common_8h.html#a025de454ae4eec948d955fd67b2c1a47af882ecbdd08f4b410b82ca4894208040">HyperPlatformBugCheck::kTripleFaultVmExit</a></div><div class="ttdoc">A triple fault VM-exit occured. </div></div>
<div class="ttc" id="struct_shared_processor_data_html_a6f7691959781f3a51651136d5419b9cb"><div class="ttname"><a href="struct_shared_processor_data.html#a6f7691959781f3a51651136d5419b9cb">SharedProcessorData::ept_data</a></div><div class="ttdeci">struct EptData * ept_data</div><div class="ttdoc">A pointer to EPT related data. </div><div class="ttdef"><b>Definition:</b> <a href="vmm_8h_source.html#l00035">vmm.h:35</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba7c4ad323abdb427c1cee8152c50a2953"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba7c4ad323abdb427c1cee8152c50a2953">VmcsField::kGuestRflags</a></div></div>
<div class="ttc" id="union_gdtr_or_idtr_access_qualification_html_aec56ad6f967b1bc16d6d1b5ba8d0d250"><div class="ttname"><a href="union_gdtr_or_idtr_access_qualification.html#aec56ad6f967b1bc16d6d1b5ba8d0d250">GdtrOrIdtrAccessQualification::base_register</a></div><div class="ttdeci">ULONG32 base_register</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01064">ia32_type.h:1064</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a09188c6f080645a99f9da56aa389ae10a87c2fabd0645f060143339804f9731db"><div class="ttname"><a href="ia32__type_8h.html#a09188c6f080645a99f9da56aa389ae10a87c2fabd0645f060143339804f9731db">InterruptionVector::kBreakpointException</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbaa6dd29e51c781fd5c3c3737b4b4d935b"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaa6dd29e51c781fd5c3c3737b4b4d935b">VmcsField::kGuestCr4</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba73fa622f28ef655069a049bbeb89fbdf"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba73fa622f28ef655069a049bbeb89fbdf">VmcsField::kGuestRip</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9ea83cb55cfd5b579a9454777887458cff4"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea83cb55cfd5b579a9454777887458cff4">VmxExitReason::kInvd</a></div></div>
<div class="ttc" id="vmm_8cpp_html_aa7cfdb9078ff33633b0a2d00754b121f"><div class="ttname"><a href="vmm_8cpp.html#aa7cfdb9078ff33633b0a2d00754b121f">VmmpHandleXsetbv</a></div><div class="ttdeci">static void VmmpHandleXsetbv(_Inout_ GuestContext *guest_context)</div></div>
<div class="ttc" id="union_vm_entry_interruption_information_field_html_a97f3a81fc1e370f877b35135a6fdad97"><div class="ttname"><a href="union_vm_entry_interruption_information_field.html#a97f3a81fc1e370f877b35135a6fdad97">VmEntryInterruptionInformationField::valid</a></div><div class="ttdeci">ULONG32 valid</div><div class="ttdoc">[31] </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01340">ia32_type.h:1340</a></div></div>
<div class="ttc" id="vmm_8cpp_html_aacfe3935f1fc13bf1f13dfb576475949"><div class="ttname"><a href="vmm_8cpp.html#aacfe3935f1fc13bf1f13dfb576475949">VmmpHandleUnexpectedExit</a></div><div class="ttdeci">static DECLSPEC_NORETURN void VmmpHandleUnexpectedExit(_Inout_ GuestContext *guest_context)</div></div>
<div class="ttc" id="union_ldtr_or_tr_access_qualification_html_a2037b01950f861aa3acf8d26a6da7ea6"><div class="ttname"><a href="union_ldtr_or_tr_access_qualification.html#a2037b01950f861aa3acf8d26a6da7ea6">LdtrOrTrAccessQualification::instruction_identity</a></div><div class="ttdeci">ULONG32 instruction_identity</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01096">ia32_type.h:1096</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbaeef5a1099a9158d515975aaf9f474918"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaeef5a1099a9158d515975aaf9f474918">VmcsField::kGuestGdtrLimit</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbaab62caa0bfded08705282b36b37c68fa"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaab62caa0bfded08705282b36b37c68fa">VmcsField::kGuestDsLimit</a></div></div>
<div class="ttc" id="vmm_8cpp_html_ade8bb0841b4ed7f6fd3888cbd1963ffb"><div class="ttname"><a href="vmm_8cpp.html#ade8bb0841b4ed7f6fd3888cbd1963ffb">VmmpHandleTripleFault</a></div><div class="ttdeci">static DECLSPEC_NORETURN void VmmpHandleTripleFault(_Inout_ GuestContext *guest_context)</div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbac9775f4589417bca403533f54377bc84"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbac9775f4589417bca403533f54377bc84">VmcsField::kIoBitmapA</a></div></div>
<div class="ttc" id="union_ldtr_or_tr_access_qualification_html_acbb5f3b2ad2605ad837964656b55f8a4"><div class="ttname"><a href="union_ldtr_or_tr_access_qualification.html#acbb5f3b2ad2605ad837964656b55f8a4">LdtrOrTrAccessQualification::base_register</a></div><div class="ttdeci">ULONG32 base_register</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01094">ia32_type.h:1094</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9ea9d5222f0fa2a9758d85e96e31a3cc294"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea9d5222f0fa2a9758d85e96e31a3cc294">VmxExitReason::kVmon</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbaf7614f4dd86fff020ebf1cd7631aeb26"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaf7614f4dd86fff020ebf1cd7631aeb26">VmcsField::kGuestLdtrLimit</a></div></div>
<div class="ttc" id="union_gdtr_or_idtr_access_qualification_html_a787c90522123daa00a4769a7b8a4cbf4"><div class="ttname"><a href="union_gdtr_or_idtr_access_qualification.html#a787c90522123daa00a4769a7b8a4cbf4">GdtrOrIdtrAccessQualification::index_register_invalid</a></div><div class="ttdeci">ULONG32 index_register_invalid</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01063">ia32_type.h:1063</a></div></div>
<div class="ttc" id="asm_8h_html_af23b5ae36ce1352e2bc5a9a0999e4cb2"><div class="ttname"><a href="asm_8h.html#af23b5ae36ce1352e2bc5a9a0999e4cb2">AsmXsetbv</a></div><div class="ttdeci">void __stdcall AsmXsetbv(_In_ ULONG32 index, _In_ ULONG32 high_value, _In_ ULONG32 low_value)</div><div class="ttdoc">Sets extended control register (XCR) </div></div>
<div class="ttc" id="union_mov_cr_qualification_html_a1ce59f155a6b95debb3e74de31f8d39e"><div class="ttname"><a href="union_mov_cr_qualification.html#a1ce59f155a6b95debb3e74de31f8d39e">MovCrQualification::access_type</a></div><div class="ttdeci">ULONG_PTR access_type</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01136">ia32_type.h:1136</a></div></div>
<div class="ttc" id="vmm_8cpp_html_a558ceb9b748edc1d0d0a881d98ebc62b"><div class="ttname"><a href="vmm_8cpp.html#a558ceb9b748edc1d0d0a881d98ebc62b">VmmpDumpGuestSelectors</a></div><div class="ttdeci">static void VmmpDumpGuestSelectors()</div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00956">vmm.cpp:956</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a555d15179398f3cd5a63b13d997f9cbcace1c1c284858816e627d1dac60d368c3"><div class="ttname"><a href="ia32__type_8h.html#a555d15179398f3cd5a63b13d997f9cbcace1c1c284858816e627d1dac60d368c3">GdtrOrIdtrScaling::kNoScaling</a></div></div>
<div class="ttc" id="struct_guest_context_html_ad5fde384d1b94f80cec6f1ffa0f2327c"><div class="ttname"><a href="struct_guest_context.html#ad5fde384d1b94f80cec6f1ffa0f2327c">GuestContext::vm_continue</a></div><div class="ttdeci">bool vm_continue</div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00062">vmm.cpp:62</a></div></div>
<div class="ttc" id="union_flag_register_html_a3f12edac6aebefb797ca15ad95e99eaf"><div class="ttname"><a href="union_flag_register.html#a3f12edac6aebefb797ca15ad95e99eaf">FlagRegister::pf</a></div><div class="ttdeci">ULONG_PTR pf</div><div class="ttdoc">[2] Parity flag </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00042">ia32_type.h:42</a></div></div>
<div class="ttc" id="util_8cpp_html_a26380029ce6cda809af3b6794674debd"><div class="ttname"><a href="util_8cpp.html#a26380029ce6cda809af3b6794674debd">UtilInveptAll</a></div><div class="ttdeci">VmxStatus UtilInveptAll()</div><div class="ttdoc">Executes the INVEPT instruction and invalidates EPT entry cache. </div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00641">util.cpp:641</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9ead86d6ae12f548eefcff89550cb6b2f3d"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ead86d6ae12f548eefcff89550cb6b2f3d">VmxExitReason::kVmclear</a></div></div>
<div class="ttc" id="util_8cpp_html_a47aa45a9e2a816d5cf54a0173d4e786f"><div class="ttname"><a href="util_8cpp.html#a47aa45a9e2a816d5cf54a0173d4e786f">UtilVmWrite</a></div><div class="ttdeci">VmxStatus UtilVmWrite(VmcsField field, ULONG_PTR field_value)</div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00587">util.cpp:587</a></div></div>
<div class="ttc" id="union_vm_entry_interruption_information_field_html_aa4708a2c6b44a05b9f05354626106b62"><div class="ttname"><a href="union_vm_entry_interruption_information_field.html#aa4708a2c6b44a05b9f05354626106b62">VmEntryInterruptionInformationField::interruption_type</a></div><div class="ttdeci">ULONG32 interruption_type</div><div class="ttdoc">[8:10] </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01337">ia32_type.h:1337</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba7a823dc9b77787fd973d184fcd05bc1b"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba7a823dc9b77787fd973d184fcd05bc1b">VmcsField::kVmxInstructionInfo</a></div></div>
<div class="ttc" id="union_gdtr_or_idtr_access_qualification_html_a4c48558ecf747d3fb1e6c99e84a01df4"><div class="ttname"><a href="union_gdtr_or_idtr_access_qualification.html#a4c48558ecf747d3fb1e6c99e84a01df4">GdtrOrIdtrAccessQualification::fields</a></div><div class="ttdeci">struct GdtrOrIdtrAccessQualification::@24 fields</div></div>
<div class="ttc" id="struct_gp_registers_x86_html_a896f0e1bdb321c03be37a22d5b0fa723"><div class="ttname"><a href="struct_gp_registers_x86.html#a896f0e1bdb321c03be37a22d5b0fa723">GpRegistersX86::ax</a></div><div class="ttdeci">ULONG_PTR ax</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00095">ia32_type.h:95</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9ea314050a14997075f3822679589dcbcea"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea314050a14997075f3822679589dcbcea">VmxExitReason::kVmlaunch</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba0cd2a9e3f9188694e265f957d4db2cb0"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba0cd2a9e3f9188694e265f957d4db2cb0">VmcsField::kGuestGsLimit</a></div></div>
<div class="ttc" id="log_8h_html_aca3702a7bd5f85eb129bf7f3d77e3a32"><div class="ttname"><a href="log_8h.html#aca3702a7bd5f85eb129bf7f3d77e3a32">HYPERPLATFORM_LOG_INFO_SAFE</a></div><div class="ttdeci">#define HYPERPLATFORM_LOG_INFO_SAFE(format,...)                                            </div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00062">log.h:62</a></div></div>
<div class="ttc" id="union_ldtr_or_tr_access_qualification_html_a28e3a94d5d616bb1cbb0b5cefe539546"><div class="ttname"><a href="union_ldtr_or_tr_access_qualification.html#a28e3a94d5d616bb1cbb0b5cefe539546">LdtrOrTrAccessQualification::scalling</a></div><div class="ttdeci">ULONG32 scalling</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01085">ia32_type.h:1085</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9eaa1ad9009b0e9469600233988337ec4ae"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9eaa1ad9009b0e9469600233988337ec4ae">VmxExitReason::kRdtsc</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a09188c6f080645a99f9da56aa389ae10abaa21de466b1ec9be2567812eef7fa1f"><div class="ttname"><a href="ia32__type_8h.html#a09188c6f080645a99f9da56aa389ae10abaa21de466b1ec9be2567812eef7fa1f">InterruptionVector::kGeneralProtectionException</a></div></div>
<div class="ttc" id="vmm_8cpp_html_aa5d99c76ea02860a68441b9f3a584178"><div class="ttname"><a href="vmm_8cpp.html#aa5d99c76ea02860a68441b9f3a584178">VmmpHandleLdtrOrTrAccess</a></div><div class="ttdeci">static void VmmpHandleLdtrOrTrAccess(_Inout_ GuestContext *guest_context)</div></div>
<div class="ttc" id="vmm_8cpp_html_a8d1112d4612a2a6b2b56eb39ae3ed539"><div class="ttname"><a href="vmm_8cpp.html#a8d1112d4612a2a6b2b56eb39ae3ed539">g_vmmp_next_history_index</a></div><div class="ttdeci">static ULONG g_vmmp_next_history_index[kVmmpNumberOfProcessors]</div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00148">vmm.cpp:148</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba7c38d39e9c12bd7b1df0cfac168cafa1"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba7c38d39e9c12bd7b1df0cfac168cafa1">VmcsField::kVmExitInstructionLen</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba6ce8504584966b00c3171d153b69b7eb"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba6ce8504584966b00c3171d153b69b7eb">VmcsField::kGuestGdtrBase</a></div></div>
<div class="ttc" id="vmm_8cpp_html_a86625e8afcfcba068b8785da1aef74e2"><div class="ttname"><a href="vmm_8cpp.html#a86625e8afcfcba068b8785da1aef74e2">VmmpHandleVmExit</a></div><div class="ttdeci">static void VmmpHandleVmExit(_Inout_ GuestContext *guest_context)</div></div>
<div class="ttc" id="ia32__type_8h_html_a66faebb03d006844eb8f9306d9d438fea666b7de6fe17990c0cbde37dd28fb9e0"><div class="ttname"><a href="ia32__type_8h.html#a66faebb03d006844eb8f9306d9d438fea666b7de6fe17990c0cbde37dd28fb9e0">MovCrAccessType::kLmsw</a></div></div>
<div class="ttc" id="performance_8h_html_a177eecc7a326a434e5c1667cc83a8f03"><div class="ttname"><a href="performance_8h.html#a177eecc7a326a434e5c1667cc83a8f03">HYPERPLATFORM_PERFORMANCE_MEASURE_THIS_SCOPE</a></div><div class="ttdeci">#define HYPERPLATFORM_PERFORMANCE_MEASURE_THIS_SCOPE()</div><div class="ttdef"><b>Definition:</b> <a href="performance_8h_source.html#l00030">performance.h:30</a></div></div>
<div class="ttc" id="union_mov_dr_qualification_html_a971347906624fa14f2247fb6ad2e7892"><div class="ttname"><a href="union_mov_dr_qualification.html#a971347906624fa14f2247fb6ad2e7892">MovDrQualification::gp_register</a></div><div class="ttdeci">ULONG_PTR gp_register</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01116">ia32_type.h:1116</a></div></div>
<div class="ttc" id="union_vm_entry_interruption_information_field_html_aed60e16c758588e355861917f2a4f1d0"><div class="ttname"><a href="union_vm_entry_interruption_information_field.html#aed60e16c758588e355861917f2a4f1d0">VmEntryInterruptionInformationField::vector</a></div><div class="ttdeci">ULONG32 vector</div><div class="ttdoc">[0:7] </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01336">ia32_type.h:1336</a></div></div>
<div class="ttc" id="struct_guest_context_html_a01bf10f212de6a6b8e6146619749f433"><div class="ttname"><a href="struct_guest_context.html#a01bf10f212de6a6b8e6146619749f433">GuestContext::irql</a></div><div class="ttdeci">KIRQL irql</div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00061">vmm.cpp:61</a></div></div>
<div class="ttc" id="union_ldtr_or_tr_access_qualification_html"><div class="ttname"><a href="union_ldtr_or_tr_access_qualification.html">LdtrOrTrAccessQualification</a></div><div class="ttdoc">See: Format of the VM-Exit Instruction-Information Field as Used for LLDT, LTR, SLDT, and STR. </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01082">ia32_type.h:1082</a></div></div>
<div class="ttc" id="struct_all_registers_html_a71178c6ec16f6e39a2d102b438315d5f"><div class="ttname"><a href="struct_all_registers.html#a71178c6ec16f6e39a2d102b438315d5f">AllRegisters::flags</a></div><div class="ttdeci">FlagRegister flags</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00108">ia32_type.h:108</a></div></div>
<div class="ttc" id="struct_guest_context_html"><div class="ttname"><a href="struct_guest_context.html">GuestContext</a></div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00053">vmm.cpp:53</a></div></div>
<div class="ttc" id="ia32__type_8h_html_af02f226cd3a56b4fcc0a54efc9e89d68aeaabae89931ae24f2288931cbe332dcb"><div class="ttname"><a href="ia32__type_8h.html#af02f226cd3a56b4fcc0a54efc9e89d68aeaabae89931ae24f2288931cbe332dcb">interruption_type::kHardwareException</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9ea8114300f5edaa7679e348df4386f0e74"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea8114300f5edaa7679e348df4386f0e74">VmxExitReason::kEptMisconfig</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbadc13324fa79ae10691ffe34828ac907d"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbadc13324fa79ae10691ffe34828ac907d">VmcsField::kGuestGsSelector</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba9757b2880044df6a4ea8f05d5130af8a"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba9757b2880044df6a4ea8f05d5130af8a">VmcsField::kVmExitIntrErrorCode</a></div></div>
<div class="ttc" id="performance_8h_html"><div class="ttname"><a href="performance_8h.html">performance.h</a></div><div class="ttdoc">Declares interfaces to performance measurement functions. </div></div>
<div class="ttc" id="common_8h_html_ae06c86efd7f271e00cb4f501fbca6e1a"><div class="ttname"><a href="common_8h.html#ae06c86efd7f271e00cb4f501fbca6e1a">IsX64</a></div><div class="ttdeci">constexpr bool IsX64()</div><div class="ttdoc">Checks if a system is x64. </div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00113">common.h:113</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a66faebb03d006844eb8f9306d9d438fea02e3317fda681e9cd1d7514e6d265f93"><div class="ttname"><a href="ia32__type_8h.html#a66faebb03d006844eb8f9306d9d438fea02e3317fda681e9cd1d7514e6d265f93">MovCrAccessType::kMoveFromCr</a></div></div>
<div class="ttc" id="struct_guest_context_html_a5137680c60d5726f6cec0e925d9b25b1"><div class="ttname"><a href="struct_guest_context.html#a5137680c60d5726f6cec0e925d9b25b1">GuestContext::stack</a></div><div class="ttdeci">VmmInitialStack * stack</div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00055">vmm.cpp:55</a></div></div>
<div class="ttc" id="struct_gp_registers_x86_html"><div class="ttname"><a href="struct_gp_registers_x86.html">GpRegistersX86</a></div><div class="ttdoc">Reprsents a stack layout after PUSHAD. </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00087">ia32_type.h:87</a></div></div>
<div class="ttc" id="common_8h_html_ab555eaf608d224d2229f6bdd726ab95b"><div class="ttname"><a href="common_8h.html#ab555eaf608d224d2229f6bdd726ab95b">HYPERPLATFORM_COMMON_DBG_BREAK</a></div><div class="ttdeci">#define HYPERPLATFORM_COMMON_DBG_BREAK()</div><div class="ttdoc">Sets a break point that works only when a debugger is enabled. </div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00045">common.h:45</a></div></div>
<div class="ttc" id="vmm_8cpp_html_a7889383e3e67c7507cde12bd68c0edd3"><div class="ttname"><a href="vmm_8cpp.html#a7889383e3e67c7507cde12bd68c0edd3">VmmpHandleVmx</a></div><div class="ttdeci">static void VmmpHandleVmx(_Inout_ GuestContext *guest_context)</div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9ea7e8200b4c01953425c19a0a7252cb0e8"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea7e8200b4c01953425c19a0a7252cb0e8">VmxExitReason::kDrAccess</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba629b80e522cc8573429756431d936ba2"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba629b80e522cc8573429756431d936ba2">VmcsField::kGuestCsArBytes</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a555d15179398f3cd5a63b13d997f9cbca735c8b7ad0a957b6a3a162c379d07e0f"><div class="ttname"><a href="ia32__type_8h.html#a555d15179398f3cd5a63b13d997f9cbca735c8b7ad0a957b6a3a162c379d07e0f">GdtrOrIdtrScaling::kScaleBy8</a></div></div>
<div class="ttc" id="union_flag_register_html_a1703c783f80d99158cd31de0affa3931"><div class="ttname"><a href="union_flag_register.html#a1703c783f80d99158cd31de0affa3931">FlagRegister::af</a></div><div class="ttdeci">ULONG_PTR af</div><div class="ttdoc">[4] Borrow flag </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00044">ia32_type.h:44</a></div></div>
<div class="ttc" id="common_8h_html_a2fa75a42dd2f34590bed16f1583b2a9c"><div class="ttname"><a href="common_8h.html#a2fa75a42dd2f34590bed16f1583b2a9c">HYPERPLATFORM_COMMON_BUG_CHECK</a></div><div class="ttdeci">#define HYPERPLATFORM_COMMON_BUG_CHECK(hp_bug_check_code, param1, param2,     param3)                                                          </div><div class="ttdoc">Issues a bug check. </div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00059">common.h:59</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ad7fa819ac11bf3c318c37fe162898ea9a3bc953d1da4aa6ef5d81de282aa6f3d3"><div class="ttname"><a href="ia32__type_8h.html#ad7fa819ac11bf3c318c37fe162898ea9a3bc953d1da4aa6ef5d81de282aa6f3d3">LdtrOrTrInstructionIdentity::kLtr</a></div></div>
<div class="ttc" id="union_flag_register_html_aecf8883866e35dc3eeffb2751b47ae08"><div class="ttname"><a href="union_flag_register.html#aecf8883866e35dc3eeffb2751b47ae08">FlagRegister::cf</a></div><div class="ttdeci">ULONG_PTR cf</div><div class="ttdoc">[0] Carry flag </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00040">ia32_type.h:40</a></div></div>
<div class="ttc" id="union_vm_exit_information_html_aca1d0a24280bc09c427263b0f2ae4370"><div class="ttname"><a href="union_vm_exit_information.html#aca1d0a24280bc09c427263b0f2ae4370">VmExitInformation::reason</a></div><div class="ttdeci">VmxExitReason reason</div><div class="ttdoc">[0:15] </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01010">ia32_type.h:1010</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a4147596d7b12d334d9a2f2a1ada16b3ba80e0a26060ce36afaaea7b43cde8ec2a"><div class="ttname"><a href="ia32__type_8h.html#a4147596d7b12d334d9a2f2a1ada16b3ba80e0a26060ce36afaaea7b43cde8ec2a">GdtrOrIdtrInstructionIdentity::kLidt</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a65b496b2a5595032807adc67e57e2e9ea14ee780d4a4a917fac14fa94889096c5"><div class="ttname"><a href="ia32__type_8h.html#a65b496b2a5595032807adc67e57e2e9ea14ee780d4a4a917fac14fa94889096c5">Msr::kIa32SysenterEsp</a></div></div>
<div class="ttc" id="vmm_8cpp_html_a076579c5628cc2f15b0713f218cb6bed"><div class="ttname"><a href="vmm_8cpp.html#a076579c5628cc2f15b0713f218cb6bed">VmmpHandleMsrReadAccess</a></div><div class="ttdeci">static void VmmpHandleMsrReadAccess(_Inout_ GuestContext *guest_context)</div></div>
<div class="ttc" id="struct_guest_context_html_a387d47754ddefc13d947494ac049d9e8"><div class="ttname"><a href="struct_guest_context.html#a387d47754ddefc13d947494ac049d9e8">GuestContext::flag_reg</a></div><div class="ttdeci">FlagRegister flag_reg</div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00058">vmm.cpp:58</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba502285fd8b67e2604115422d9d3759f2"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba502285fd8b67e2604115422d9d3759f2">VmcsField::kGuestTrSelector</a></div></div>
<div class="ttc" id="struct_vmm_initial_stack_html_a6b89b9f39309c193706089082eac50f6"><div class="ttname"><a href="struct_vmm_initial_stack.html#a6b89b9f39309c193706089082eac50f6">VmmInitialStack::gp_regs</a></div><div class="ttdeci">GpRegisters gp_regs</div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00047">vmm.cpp:47</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba3d82afd83745ee0d6e5fa539e40d8ce7"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba3d82afd83745ee0d6e5fa539e40d8ce7">VmcsField::kGuestRsp</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba7803322c278f9bbfe4ca10d4046b20d6"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba7803322c278f9bbfe4ca10d4046b20d6">VmcsField::kExitQualification</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba79885d1b8f0d3694a6180af35ed0ffe3"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba79885d1b8f0d3694a6180af35ed0ffe3">VmcsField::kGuestDsBase</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a4147596d7b12d334d9a2f2a1ada16b3bad33dbbeac5223ee6fe4ff14e2beea4fd"><div class="ttname"><a href="ia32__type_8h.html#a4147596d7b12d334d9a2f2a1ada16b3bad33dbbeac5223ee6fe4ff14e2beea4fd">GdtrOrIdtrInstructionIdentity::kLgdt</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba377beaedc666fb495a5de99bff6667e9"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba377beaedc666fb495a5de99bff6667e9">VmcsField::kVmEntryIntrInfoField</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9eaad2af80a0c01945b951659e23c2a008a"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9eaad2af80a0c01945b951659e23c2a008a">VmxExitReason::kVmread</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9eadd061a9d46c215e553ab549208c6dc65"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9eadd061a9d46c215e553ab549208c6dc65">VmxExitReason::kRdtscp</a></div></div>
<div class="ttc" id="vmm_8cpp_html_a5a138d54b705286e8ebf2ae1c84763b9"><div class="ttname"><a href="vmm_8cpp.html#a5a138d54b705286e8ebf2ae1c84763b9">VmmpHandleRdtscp</a></div><div class="ttdeci">static void VmmpHandleRdtscp(_Inout_ GuestContext *guest_context)</div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9ea392e859b66b58678566f8cb982cc36f0"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea392e859b66b58678566f8cb982cc36f0">VmxExitReason::kMsrRead</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9eadc7bdda44f5036c1c070bcd34baf8eb9"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9eadc7bdda44f5036c1c070bcd34baf8eb9">VmxExitReason::kVmoff</a></div></div>
<div class="ttc" id="union_vm_exit_information_html_a5a8a912813aa7d49a9395e53f56de5a6"><div class="ttname"><a href="union_vm_exit_information.html#a5a8a912813aa7d49a9395e53f56de5a6">VmExitInformation::fields</a></div><div class="ttdeci">struct VmExitInformation::@23 fields</div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba54ec8cb69b3a6f7caa8978cc6cb3e7d5"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba54ec8cb69b3a6f7caa8978cc6cb3e7d5">VmcsField::kGuestPhysicalAddress</a></div></div>
<div class="ttc" id="union_ldtr_or_tr_access_qualification_html_aff8d0046aeb84c466a578f1abb620185"><div class="ttname"><a href="union_ldtr_or_tr_access_qualification.html#aff8d0046aeb84c466a578f1abb620185">LdtrOrTrAccessQualification::base_register_invalid</a></div><div class="ttdeci">ULONG32 base_register_invalid</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01095">ia32_type.h:1095</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbaad7582d0322aa73fa721b7119125214f"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaad7582d0322aa73fa721b7119125214f">VmcsField::kGuestEsBase</a></div></div>
<div class="ttc" id="ept_8h_html"><div class="ttname"><a href="ept_8h.html">ept.h</a></div><div class="ttdoc">Declares interfaces to EPT functions. </div></div>
<div class="ttc" id="struct_gp_registers_x86_html_a85d9a723e3edf9d1bc3f9cd1a977b7ee"><div class="ttname"><a href="struct_gp_registers_x86.html#a85d9a723e3edf9d1bc3f9cd1a977b7ee">GpRegistersX86::di</a></div><div class="ttdeci">ULONG_PTR di</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00088">ia32_type.h:88</a></div></div>
<div class="ttc" id="struct_gp_registers_x86_html_a01ff4b8d095922bbe45840bf2192c361"><div class="ttname"><a href="struct_gp_registers_x86.html#a01ff4b8d095922bbe45840bf2192c361">GpRegistersX86::sp</a></div><div class="ttdeci">ULONG_PTR sp</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00091">ia32_type.h:91</a></div></div>
<div class="ttc" id="vmm_8cpp_html_a74d575262c9085bf28b9de246129c17e"><div class="ttname"><a href="vmm_8cpp.html#a74d575262c9085bf28b9de246129c17e">VmmpAdjustGuestInstructionPointer</a></div><div class="ttdeci">static void VmmpAdjustGuestInstructionPointer(_In_ ULONG_PTR guest_ip)</div></div>
<div class="ttc" id="union_vm_entry_interruption_information_field_html_a7240d1c95f4ec56ea07c470ccb5e7716"><div class="ttname"><a href="union_vm_entry_interruption_information_field.html#a7240d1c95f4ec56ea07c470ccb5e7716">VmEntryInterruptionInformationField::fields</a></div><div class="ttdeci">struct VmEntryInterruptionInformationField::@37 fields</div></div>
<div class="ttc" id="struct_vm_exit_history_html_ae2de9c4bc442c47de3dc81b018a1738a"><div class="ttname"><a href="struct_vm_exit_history.html#ae2de9c4bc442c47de3dc81b018a1738a">VmExitHistory::gp_regs</a></div><div class="ttdeci">GpRegisters gp_regs</div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00072">vmm.cpp:72</a></div></div>
<div class="ttc" id="vmm_8cpp_html_aa596f94adf844e3a4e19d664c07d9968"><div class="ttname"><a href="vmm_8cpp.html#aa596f94adf844e3a4e19d664c07d9968">VmmVmExitHandler</a></div><div class="ttdeci">bool __stdcall VmmVmExitHandler(_Inout_ VmmInitialStack *stack)</div></div>
<div class="ttc" id="struct_processor_data_html_aacd3c5235d2d598f119585f3aa77d68b"><div class="ttname"><a href="struct_processor_data.html#aacd3c5235d2d598f119585f3aa77d68b">ProcessorData::shared_data</a></div><div class="ttdeci">SharedProcessorData * shared_data</div><div class="ttdoc">Shared data. </div><div class="ttdef"><b>Definition:</b> <a href="vmm_8h_source.html#l00040">vmm.h:40</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a22df35a31e9f08c48a653f5571e7e405aacd654b01c62015ead11357300c14b59"><div class="ttname"><a href="ia32__type_8h.html#a22df35a31e9f08c48a653f5571e7e405aacd654b01c62015ead11357300c14b59">GdtrOrIdtrAaddressSize::k32bit</a></div></div>
<div class="ttc" id="union_ldtr_or_tr_access_qualification_html_ac6754e5172725ae916f0d5289af6e196"><div class="ttname"><a href="union_ldtr_or_tr_access_qualification.html#ac6754e5172725ae916f0d5289af6e196">LdtrOrTrAccessQualification::fields</a></div><div class="ttdeci">struct LdtrOrTrAccessQualification::@25 fields</div></div>
<div class="ttc" id="union_gdtr_or_idtr_access_qualification_html_accdb0a994dd6875ac6b75556dc6156d1"><div class="ttname"><a href="union_gdtr_or_idtr_access_qualification.html#accdb0a994dd6875ac6b75556dc6156d1">GdtrOrIdtrAccessQualification::base_register_invalid</a></div><div class="ttdeci">ULONG32 base_register_invalid</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01065">ia32_type.h:1065</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9eadc032bcdb030aa32caacc1539d36b27e"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9eadc032bcdb030aa32caacc1539d36b27e">VmxExitReason::kMsrWrite</a></div></div>
<div class="ttc" id="ia32__type_8h_html_af02f226cd3a56b4fcc0a54efc9e89d68a19d6a5eed636ff60c09d352fb562d2ab"><div class="ttname"><a href="ia32__type_8h.html#af02f226cd3a56b4fcc0a54efc9e89d68a19d6a5eed636ff60c09d352fb562d2ab">interruption_type::kSoftwareException</a></div></div>
<div class="ttc" id="union_vm_exit_interruption_information_field_html_a68bd7ad6a7be7847d637740d32902124"><div class="ttname"><a href="union_vm_exit_interruption_information_field.html#a68bd7ad6a7be7847d637740d32902124">VmExitInterruptionInformationField::fields</a></div><div class="ttdeci">struct VmExitInterruptionInformationField::@36 fields</div></div>
<div class="ttc" id="union_flag_register_html_a5c93781864e367ede0b0b0a44d0af4ca"><div class="ttname"><a href="union_flag_register.html#a5c93781864e367ede0b0b0a44d0af4ca">FlagRegister::fields</a></div><div class="ttdeci">struct FlagRegister::@1 fields</div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9ead84d21d1dd4f4776d77142f7344d60d9"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ead84d21d1dd4f4776d77142f7344d60d9">VmxExitReason::kInvlpg</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9ea440a40769c0750c23d47bf35660f2fdc"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea440a40769c0750c23d47bf35660f2fdc">VmxExitReason::kCrAccess</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a555d15179398f3cd5a63b13d997f9cbcadaaf08ec8a904bec532e8444ec0597e2"><div class="ttname"><a href="ia32__type_8h.html#a555d15179398f3cd5a63b13d997f9cbcadaaf08ec8a904bec532e8444ec0597e2">GdtrOrIdtrScaling::kScaleBy4</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbaa0e5b39f35a832fd9621f0bb57200d86"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaa0e5b39f35a832fd9621f0bb57200d86">VmcsField::kVmEntryExceptionErrorCode</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a73982edbee1cbccffb602e32bc1c4f83aa2f4f9c9ca65834f778e825f82304cc2"><div class="ttname"><a href="ia32__type_8h.html#a73982edbee1cbccffb602e32bc1c4f83aa2f4f9c9ca65834f778e825f82304cc2">MovDrDirection::kMoveFromDr</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba6e92404f2eb70dfb318a45138afb4b1d"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba6e92404f2eb70dfb318a45138afb4b1d">VmcsField::kGuestSysenterCs</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a65b496b2a5595032807adc67e57e2e9eaeee8a9a34e97dd384dcff79576802fd5"><div class="ttname"><a href="ia32__type_8h.html#a65b496b2a5595032807adc67e57e2e9eaeee8a9a34e97dd384dcff79576802fd5">Msr::kIa32SysenterCs</a></div></div>
<div class="ttc" id="union_flag_register_html_a162a6e44378f3cc0e9f569451e808542"><div class="ttname"><a href="union_flag_register.html#a162a6e44378f3cc0e9f569451e808542">FlagRegister::all</a></div><div class="ttdeci">ULONG_PTR all</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00038">ia32_type.h:38</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba2fe1631936f4c6b1c82e46dd3b134eac"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba2fe1631936f4c6b1c82e46dd3b134eac">VmcsField::kGuestDsSelector</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9ea1811c2565bed5527991294be7fad52d3"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea1811c2565bed5527991294be7fad52d3">VmxExitReason::kVmwrite</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba8887704debef8cf47a2771d2bcf35296"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba8887704debef8cf47a2771d2bcf35296">VmcsField::kGuestSysenterEsp</a></div></div>
<div class="ttc" id="struct_vm_exit_history_html"><div class="ttname"><a href="struct_vm_exit_history.html">VmExitHistory</a></div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00071">vmm.cpp:71</a></div></div>
<div class="ttc" id="union_page_fault_error_code_html"><div class="ttname"><a href="union_page_fault_error_code.html">PageFaultErrorCode</a></div><div class="ttdoc">See: Page-Fault Error Code. </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00436">ia32_type.h:436</a></div></div>
<div class="ttc" id="struct_gp_registers_x86_html_a8293b482ed199a0e71367cfb7ad82840"><div class="ttname"><a href="struct_gp_registers_x86.html#a8293b482ed199a0e71367cfb7ad82840">GpRegistersX86::dx</a></div><div class="ttdeci">ULONG_PTR dx</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00093">ia32_type.h:93</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ad7fa819ac11bf3c318c37fe162898ea9ad27284bb9f714b7c386d36232f9b29be"><div class="ttname"><a href="ia32__type_8h.html#ad7fa819ac11bf3c318c37fe162898ea9ad27284bb9f714b7c386d36232f9b29be">LdtrOrTrInstructionIdentity::kStr</a></div></div>
<div class="ttc" id="struct_guest_context_html_a3f90f85ee5bdb906b5ee465bf77c7ad9"><div class="ttname"><a href="struct_guest_context.html#a3f90f85ee5bdb906b5ee465bf77c7ad9">GuestContext::gp_regs</a></div><div class="ttdeci">GpRegisters * gp_regs</div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00056">vmm.cpp:56</a></div></div>
<div class="ttc" id="vmm_8h_html"><div class="ttname"><a href="vmm_8h.html">vmm.h</a></div><div class="ttdoc">Declares interfaces to VMM functions. </div></div>
<div class="ttc" id="union_mov_cr_qualification_html_a1b46fa366b68ad8aa8f3c8d47df5e3c2"><div class="ttname"><a href="union_mov_cr_qualification.html#a1b46fa366b68ad8aa8f3c8d47df5e3c2">MovCrQualification::control_register</a></div><div class="ttdeci">ULONG_PTR control_register</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01135">ia32_type.h:1135</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba1824c10f908c38a703b5321d379e1aa7"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba1824c10f908c38a703b5321d379e1aa7">VmcsField::kGuestEsArBytes</a></div></div>
<div class="ttc" id="ept_8cpp_html_a6adf0f9672ecc2605b2e73a3dea55468"><div class="ttname"><a href="ept_8cpp.html#a6adf0f9672ecc2605b2e73a3dea55468">EptHandleEptViolation</a></div><div class="ttdeci">void EptHandleEptViolation(EptData *ept_data)</div><div class="ttdef"><b>Definition:</b> <a href="ept_8cpp_source.html#l00435">ept.cpp:435</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a66faebb03d006844eb8f9306d9d438feaefa88228d54e52df93a22f69a1affd59"><div class="ttname"><a href="ia32__type_8h.html#a66faebb03d006844eb8f9306d9d438feaefa88228d54e52df93a22f69a1affd59">MovCrAccessType::kMoveToCr</a></div></div>
<div class="ttc" id="union_mov_cr_qualification_html"><div class="ttname"><a href="union_mov_cr_qualification.html">MovCrQualification</a></div><div class="ttdoc">See: Exit Qualification for Control-Register Accesses. </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01132">ia32_type.h:1132</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba7e7fc2098784c31d10c0586c8fc2397f"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba7e7fc2098784c31d10c0586c8fc2397f">VmcsField::kGuestSysenterEip</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a09188c6f080645a99f9da56aa389ae10aa9ab9f1feab44af5e2ae4864eceed30c"><div class="ttname"><a href="ia32__type_8h.html#a09188c6f080645a99f9da56aa389ae10aa9ab9f1feab44af5e2ae4864eceed30c">InterruptionVector::kPageFaultException</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbab4167c78657b243b30d1c83c599f5449"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbab4167c78657b243b30d1c83c599f5449">VmcsField::kGuestSsArBytes</a></div></div>
<div class="ttc" id="util_8cpp_html_a9a109dbda65e2c6345c933267f2fc260"><div class="ttname"><a href="util_8cpp.html#a9a109dbda65e2c6345c933267f2fc260">UtilWriteMsr64</a></div><div class="ttdeci">void UtilWriteMsr64(Msr msr, ULONG64 value)</div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00636">util.cpp:636</a></div></div>
<div class="ttc" id="union_mov_dr_qualification_html"><div class="ttname"><a href="union_mov_dr_qualification.html">MovDrQualification</a></div><div class="ttdoc">See: Exit Qualification for MOV DR. </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01109">ia32_type.h:1109</a></div></div>
<div class="ttc" id="union_gdtr_or_idtr_access_qualification_html_aa680c63d80d53c640720c8f315472dd0"><div class="ttname"><a href="union_gdtr_or_idtr_access_qualification.html#aa680c63d80d53c640720c8f315472dd0">GdtrOrIdtrAccessQualification::address_size</a></div><div class="ttdeci">ULONG32 address_size</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01057">ia32_type.h:1057</a></div></div>
<div class="ttc" id="log_8h_html_a66562e80938c3116822fc8f72adaf24c"><div class="ttname"><a href="log_8h.html#a66562e80938c3116822fc8f72adaf24c">HYPERPLATFORM_LOG_DEBUG_SAFE</a></div><div class="ttdeci">#define HYPERPLATFORM_LOG_DEBUG_SAFE(format,...)                                            </div><div class="ttdoc">Buffers a message as respective severity. </div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00057">log.h:57</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbae63ca17bd3a83436e7a268bcc689335f"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbae63ca17bd3a83436e7a268bcc689335f">VmcsField::kGuestCr0</a></div></div>
<div class="ttc" id="union_gdtr_or_idtr_access_qualification_html_ac850f491220fd83527f4d8aad2dfaa9f"><div class="ttname"><a href="union_gdtr_or_idtr_access_qualification.html#ac850f491220fd83527f4d8aad2dfaa9f">GdtrOrIdtrAccessQualification::index_register</a></div><div class="ttdeci">ULONG32 index_register</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01062">ia32_type.h:1062</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba3306c9c3f43fc098d171942dc3cef570"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba3306c9c3f43fc098d171942dc3cef570">VmcsField::kGuestGsArBytes</a></div></div>
<div class="ttc" id="union_ldtr_or_tr_access_qualification_html_a3e85f8c2d2399697d3dc8d2cd78754d7"><div class="ttname"><a href="union_ldtr_or_tr_access_qualification.html#a3e85f8c2d2399697d3dc8d2cd78754d7">LdtrOrTrAccessQualification::index_register</a></div><div class="ttdeci">ULONG32 index_register</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01092">ia32_type.h:1092</a></div></div>
<div class="ttc" id="asm_8h_html"><div class="ttname"><a href="asm_8h.html">asm.h</a></div><div class="ttdoc">Declares interfaces to assembly functions. </div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbac69642662e350c572b949d8715094864"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbac69642662e350c572b949d8715094864">VmcsField::kGuestCsLimit</a></div></div>
<div class="ttc" id="struct_gp_registers_x86_html_ae2be97b70e97862689550d94ce1d7e04"><div class="ttname"><a href="struct_gp_registers_x86.html#ae2be97b70e97862689550d94ce1d7e04">GpRegistersX86::bx</a></div><div class="ttdeci">ULONG_PTR bx</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00092">ia32_type.h:92</a></div></div>
<div class="ttc" id="union_vm_entry_interruption_information_field_html_a9ca137dd1b812d091ba9bc7b2f2f752d"><div class="ttname"><a href="union_vm_entry_interruption_information_field.html#a9ca137dd1b812d091ba9bc7b2f2f752d">VmEntryInterruptionInformationField::all</a></div><div class="ttdeci">ULONG32 all</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01334">ia32_type.h:1334</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a65b496b2a5595032807adc67e57e2e9e"><div class="ttname"><a href="ia32__type_8h.html#a65b496b2a5595032807adc67e57e2e9e">Msr</a></div><div class="ttdeci">Msr</div><div class="ttdoc">See: MODEL-SPECIFIC REGISTERS (MSRS) </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00393">ia32_type.h:393</a></div></div>
<div class="ttc" id="union_ldtr_or_tr_access_qualification_html_a9e4144507a0ea640d3b1d94146c2ca5c"><div class="ttname"><a href="union_ldtr_or_tr_access_qualification.html#a9e4144507a0ea640d3b1d94146c2ca5c">LdtrOrTrAccessQualification::register_access</a></div><div class="ttdeci">ULONG32 register_access</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01089">ia32_type.h:1089</a></div></div>
<div class="ttc" id="union_mov_cr_qualification_html_aecc9e2003722e84dd082b9e2f477aed2"><div class="ttname"><a href="union_mov_cr_qualification.html#aecc9e2003722e84dd082b9e2f477aed2">MovCrQualification::gp_register</a></div><div class="ttdeci">ULONG_PTR gp_register</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01139">ia32_type.h:1139</a></div></div>
<div class="ttc" id="union_flag_register_html"><div class="ttname"><a href="union_flag_register.html">FlagRegister</a></div><div class="ttdoc">See: SYSTEM FLAGS AND FIELDS IN THE EFLAGS REGISTER. </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00037">ia32_type.h:37</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba5bfa8783bd0d0f214b27f25484510ac0"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba5bfa8783bd0d0f214b27f25484510ac0">VmcsField::kGuestDsArBytes</a></div></div>
<div class="ttc" id="util_8h_html"><div class="ttname"><a href="util_8h.html">util.h</a></div><div class="ttdoc">Declares interfaces to utility functions. </div></div>
<div class="ttc" id="common_8h_html_a025de454ae4eec948d955fd67b2c1a47a25c2dc47991b3df171ed5192bcf70390"><div class="ttname"><a href="common_8h.html#a025de454ae4eec948d955fd67b2c1a47a25c2dc47991b3df171ed5192bcf70390">HyperPlatformBugCheck::kUnknown</a></div><div class="ttdoc">An unspecified bug occured. </div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba589e19bdb7501ceabce9894ce2208652"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba589e19bdb7501ceabce9894ce2208652">VmcsField::kGuestSsSelector</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbae789d67e4689a0374e52c9d826d3bb3b"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbae789d67e4689a0374e52c9d826d3bb3b">VmcsField::kGuestGsBase</a></div></div>
<div class="ttc" id="union_vm_entry_interruption_information_field_html"><div class="ttname"><a href="union_vm_entry_interruption_information_field.html">VmEntryInterruptionInformationField</a></div><div class="ttdoc">See: Format of the VM-Entry Interruption-Information Field. </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01333">ia32_type.h:1333</a></div></div>
<div class="ttc" id="union_flag_register_html_a114d38566bd64e42dd4a4631f97fc672"><div class="ttname"><a href="union_flag_register.html#a114d38566bd64e42dd4a4631f97fc672">FlagRegister::zf</a></div><div class="ttdeci">ULONG_PTR zf</div><div class="ttdoc">[6] Zero flag </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00046">ia32_type.h:46</a></div></div>
<div class="ttc" id="union_vm_exit_information_html"><div class="ttname"><a href="union_vm_exit_information.html">VmExitInformation</a></div><div class="ttdoc">See: VM-ENTRY FAILURES DURING OR AFTER LOADING GUEST STATE. </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01007">ia32_type.h:1007</a></div></div>
<div class="ttc" id="union_mov_dr_qualification_html_a6855204f5ea532a25e60c6a5b9d3be6d"><div class="ttname"><a href="union_mov_dr_qualification.html#a6855204f5ea532a25e60c6a5b9d3be6d">MovDrQualification::direction</a></div><div class="ttdeci">ULONG_PTR direction</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01114">ia32_type.h:1114</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba405f81577cb4b6a3fc802546c3d9a8af"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba405f81577cb4b6a3fc802546c3d9a8af">VmcsField::kCr4ReadShadow</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbaf71cd127152a3b0c394b8269428b271a"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaf71cd127152a3b0c394b8269428b271a">VmcsField::kGuestEsSelector</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9ea6f6a3466e7ce5d73ba86fba2ae9edfcf"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea6f6a3466e7ce5d73ba86fba2ae9edfcf">VmxExitReason::kLdtrOrTrAccess</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbabcfc687436663f7b8c8ae76cdde90701"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbabcfc687436663f7b8c8ae76cdde90701">VmcsField::kVmExitReason</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cb"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cb">VmcsField</a></div><div class="ttdeci">VmcsField</div><div class="ttdoc">See: FIELD ENCODING IN VMCS. </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00449">ia32_type.h:449</a></div></div>
<div class="ttc" id="union_vm_exit_interruption_information_field_html_afc0d177a9ebf865624eac98a3ea8367c"><div class="ttname"><a href="union_vm_exit_interruption_information_field.html#afc0d177a9ebf865624eac98a3ea8367c">VmExitInterruptionInformationField::interruption_type</a></div><div class="ttdeci">ULONG32 interruption_type</div><div class="ttdoc">[8:10] </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01323">ia32_type.h:1323</a></div></div>
<div class="ttc" id="vmm_8cpp_html_a8c74dd7423915a0a5900fda92ea9f729"><div class="ttname"><a href="vmm_8cpp.html#a8c74dd7423915a0a5900fda92ea9f729">VmmpHandleRdtsc</a></div><div class="ttdeci">static void VmmpHandleRdtsc(_Inout_ GuestContext *guest_context)</div></div>
<div class="ttc" id="union_vm_exit_interruption_information_field_html"><div class="ttname"><a href="union_vm_exit_interruption_information_field.html">VmExitInterruptionInformationField</a></div><div class="ttdoc">See: Format of the VM-Exit Interruption-Information Field. </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01319">ia32_type.h:1319</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbad109d64606d00d8a78a89fd4917a0d40"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbad109d64606d00d8a78a89fd4917a0d40">VmcsField::kGuestFsLimit</a></div></div>
<div class="ttc" id="union_gdtr_or_idtr_access_qualification_html_a356bbcd26ac311ae5231010c07d8e469"><div class="ttname"><a href="union_gdtr_or_idtr_access_qualification.html#a356bbcd26ac311ae5231010c07d8e469">GdtrOrIdtrAccessQualification::instruction_identity</a></div><div class="ttdeci">ULONG32 instruction_identity</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01066">ia32_type.h:1066</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbabe340716829895c35bbd355a73204571"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbabe340716829895c35bbd355a73204571">VmcsField::kHostIa32PerfGlobalCtrlHigh</a></div></div>
<div class="ttc" id="vmm_8cpp_html_a3a8844706155374466e6af3d451ab567"><div class="ttname"><a href="vmm_8cpp.html#a3a8844706155374466e6af3d451ab567">VmmpHandleEptViolation</a></div><div class="ttdeci">static void VmmpHandleEptViolation(_Inout_ GuestContext *guest_context)</div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9ea72788e267bbcc9e8bbd542bdbc8fce13"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea72788e267bbcc9e8bbd542bdbc8fce13">VmxExitReason::kVmresume</a></div></div>
<div class="ttc" id="vmm_8cpp_html_ab949fa6efd53abc611bcfa0e41e20cf0"><div class="ttname"><a href="vmm_8cpp.html#ab949fa6efd53abc611bcfa0e41e20cf0">VmmVmxFailureHandler</a></div><div class="ttdeci">DECLSPEC_NORETURN void __stdcall VmmVmxFailureHandler(_Inout_ AllRegisters *all_regs)</div></div>
<div class="ttc" id="struct_vmm_initial_stack_html_a71969f00b28abe92d6bdc28127c782b6"><div class="ttname"><a href="struct_vmm_initial_stack.html#a71969f00b28abe92d6bdc28127c782b6">VmmInitialStack::reserved</a></div><div class="ttdeci">ULONG_PTR reserved</div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00048">vmm.cpp:48</a></div></div>
<div class="ttc" id="union_mov_dr_qualification_html_af17242d4b8c914de52f8c65c20e6b1ba"><div class="ttname"><a href="union_mov_dr_qualification.html#af17242d4b8c914de52f8c65c20e6b1ba">MovDrQualification::debugl_register</a></div><div class="ttdeci">ULONG_PTR debugl_register</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01112">ia32_type.h:1112</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba5d3f11ca12032bc442c72c5953a99898"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba5d3f11ca12032bc442c72c5953a99898">VmcsField::kVmExitIntrInfo</a></div></div>
<div class="ttc" id="common_8h_html_a025de454ae4eec948d955fd67b2c1a47adb2cba8af01b74b26ce9d8b049122174"><div class="ttname"><a href="common_8h.html#a025de454ae4eec948d955fd67b2c1a47adb2cba8af01b74b26ce9d8b049122174">HyperPlatformBugCheck::kCriticalVmxInstructionFailure</a></div><div class="ttdoc">VMRESUME or VMXOFF has failed. </div></div>
<div class="ttc" id="vmm_8cpp_html_ad2045ccea55ea3345f22cdb7e2a9a6ba"><div class="ttname"><a href="vmm_8cpp.html#ad2045ccea55ea3345f22cdb7e2a9a6ba">VmmpHandleInvalidateTLBEntry</a></div><div class="ttdeci">static void VmmpHandleInvalidateTLBEntry(_Inout_ GuestContext *guest_context)</div></div>
<div class="ttc" id="struct_vmm_initial_stack_html_a6470c7e65bd6a19c2afa6220943f38e1"><div class="ttname"><a href="struct_vmm_initial_stack.html#a6470c7e65bd6a19c2afa6220943f38e1">VmmInitialStack::processor_data</a></div><div class="ttdeci">ProcessorData * processor_data</div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00049">vmm.cpp:49</a></div></div>
<div class="ttc" id="util_8cpp_html_a15f26bbfcd972225444b7a4736cb365c"><div class="ttname"><a href="util_8cpp.html#a15f26bbfcd972225444b7a4736cb365c">UtilLoadPdptes</a></div><div class="ttdeci">void UtilLoadPdptes(ULONG_PTR cr3_value)</div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00654">util.cpp:654</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba2c1acaff8914b26a12d6c7c20360aed4"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba2c1acaff8914b26a12d6c7c20360aed4">VmcsField::kGuestIdtrBase</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9ea3744e91fc225ce5a4f100c83dd3e8897"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea3744e91fc225ce5a4f100c83dd3e8897">VmxExitReason::kTripleFault</a></div></div>
<div class="ttc" id="union_flag_register_html_a8b11871d0be1bf711079fbd8c73c5f18"><div class="ttname"><a href="union_flag_register.html#a8b11871d0be1bf711079fbd8c73c5f18">FlagRegister::sf</a></div><div class="ttdeci">ULONG_PTR sf</div><div class="ttdoc">[7] Sign flag </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00047">ia32_type.h:47</a></div></div>
<div class="ttc" id="vmm_8cpp_html_a7f4e7c5082162a3712e75eafecfd246f"><div class="ttname"><a href="vmm_8cpp.html#a7f4e7c5082162a3712e75eafecfd246f">VmmpHandleCpuid</a></div><div class="ttdeci">static void VmmpHandleCpuid(_Inout_ GuestContext *guest_context)</div></div>
<div class="ttc" id="vmm_8cpp_html_a5287d4b4b503b93a18fa48277f365997"><div class="ttname"><a href="vmm_8cpp.html#a5287d4b4b503b93a18fa48277f365997">VmmpHandleGdtrOrIdtrAccess</a></div><div class="ttdeci">static void VmmpHandleGdtrOrIdtrAccess(_Inout_ GuestContext *guest_context)</div></div>
<div class="ttc" id="vmm_8cpp_html_a5a9b39b7dbbe8954e087bb61db6be81c"><div class="ttname"><a href="vmm_8cpp.html#a5a9b39b7dbbe8954e087bb61db6be81c">VmmpHandleEptMisconfig</a></div><div class="ttdeci">static void VmmpHandleEptMisconfig(_Inout_ GuestContext *guest_context)</div></div>
<div class="ttc" id="vmm_8cpp_html_a0c357682b4fe2b2c769a2471c988131f"><div class="ttname"><a href="vmm_8cpp.html#a0c357682b4fe2b2c769a2471c988131f">kVmmpNumberOfRecords</a></div><div class="ttdeci">static const long kVmmpNumberOfRecords</div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00035">vmm.cpp:35</a></div></div>
<div class="ttc" id="vmm_8cpp_html_a0c35206d6bd25f8caa79ab139ff725a5"><div class="ttname"><a href="vmm_8cpp.html#a0c35206d6bd25f8caa79ab139ff725a5">VmmpHandleVmCall</a></div><div class="ttdeci">static void VmmpHandleVmCall(_Inout_ GuestContext *guest_context)</div></div>
<div class="ttc" id="ia32__type_8h_html_a73982edbee1cbccffb602e32bc1c4f83a9221c07ae29d32b2539b85dd37bd9218"><div class="ttname"><a href="ia32__type_8h.html#a73982edbee1cbccffb602e32bc1c4f83a9221c07ae29d32b2539b85dd37bd9218">MovDrDirection::kMoveToDr</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbac061aa91d11e4172ad791ee06c867648"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbac061aa91d11e4172ad791ee06c867648">VmcsField::kGuestFsArBytes</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9ea5e1b8a6ff6f3b933c6b5c9efad006c4f"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea5e1b8a6ff6f3b933c6b5c9efad006c4f">VmxExitReason::kEptViolation</a></div></div>
<div class="ttc" id="vmm_8cpp_html_a25ec906723d7f199fc49a820cfcb1e8c"><div class="ttname"><a href="vmm_8cpp.html#a25ec906723d7f199fc49a820cfcb1e8c">VmmpHandleInvalidateInternalCaches</a></div><div class="ttdeci">static void VmmpHandleInvalidateInternalCaches(_Inout_ GuestContext *guest_context)</div></div>
<div class="ttc" id="ia32__type_8h_html_a65b496b2a5595032807adc67e57e2e9ea154a6224d69f105f008d3eb91f88cf50"><div class="ttname"><a href="ia32__type_8h.html#a65b496b2a5595032807adc67e57e2e9ea154a6224d69f105f008d3eb91f88cf50">Msr::kIa32SysenterEip</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a4147596d7b12d334d9a2f2a1ada16b3ba7c13987389102119cbbdcf55f06dd04d"><div class="ttname"><a href="ia32__type_8h.html#a4147596d7b12d334d9a2f2a1ada16b3ba7c13987389102119cbbdcf55f06dd04d">GdtrOrIdtrInstructionIdentity::kSidt</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9ea46e509c67d7ad363dad1a02a12c5ae59"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea46e509c67d7ad363dad1a02a12c5ae59">VmxExitReason::kGdtrOrIdtrAccess</a></div></div>
<div class="ttc" id="struct_gp_registers_x86_html_a65fe3207c077d33af10061a151761368"><div class="ttname"><a href="struct_gp_registers_x86.html#a65fe3207c077d33af10061a151761368">GpRegistersX86::si</a></div><div class="ttdeci">ULONG_PTR si</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00089">ia32_type.h:89</a></div></div>
<div class="ttc" id="vmm_8cpp_html_a73a3bbff0ce5ead5ccb895cb9f948e65"><div class="ttname"><a href="vmm_8cpp.html#a73a3bbff0ce5ead5ccb895cb9f948e65">kVmmpEnableRecordVmExit</a></div><div class="ttdeci">static const long kVmmpEnableRecordVmExit</div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00032">vmm.cpp:32</a></div></div>
<div class="ttc" id="union_mov_cr_qualification_html_a4b5c1fe45bcf20765e01f24a07dcc12a"><div class="ttname"><a href="union_mov_cr_qualification.html#a4b5c1fe45bcf20765e01f24a07dcc12a">MovCrQualification::fields</a></div><div class="ttdeci">struct MovCrQualification::@27 fields</div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9ea1de4c6d7f745f23d4e034b3e59961e75"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea1de4c6d7f745f23d4e034b3e59961e75">VmxExitReason::kVmptrst</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9eafb9bf53051f3d437739b34bbd6a570f5"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9eafb9bf53051f3d437739b34bbd6a570f5">VmxExitReason::kCpuid</a></div></div>
<div class="ttc" id="util_8cpp_html_a1e0beb2532d7c8ffe16e6733aa96ee66"><div class="ttname"><a href="util_8cpp.html#a1e0beb2532d7c8ffe16e6733aa96ee66">UtilVmRead</a></div><div class="ttdeci">ULONG_PTR UtilVmRead(VmcsField field)</div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00557">util.cpp:557</a></div></div>
<div class="ttc" id="util_8cpp_html_ad8434ca108fb47650842faded523d9c4"><div class="ttname"><a href="util_8cpp.html#ad8434ca108fb47650842faded523d9c4">UtilIsX86Pae</a></div><div class="ttdeci">bool UtilIsX86Pae()</div><div class="ttdoc">Checks if the system is a PAE-enabled x86 system. </div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00313">util.cpp:313</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbae5931e70f25d94616c727cce40d6b137"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbae5931e70f25d94616c727cce40d6b137">VmcsField::kCr0ReadShadow</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a4147596d7b12d334d9a2f2a1ada16b3baff0261f43e297819cf727ff32bdc6de8"><div class="ttname"><a href="ia32__type_8h.html#a4147596d7b12d334d9a2f2a1ada16b3baff0261f43e297819cf727ff32bdc6de8">GdtrOrIdtrInstructionIdentity::kSgdt</a></div></div>
<div class="ttc" id="vmm_8cpp_html_a8b9043c100c0991d06d72d04328d8c0c"><div class="ttname"><a href="vmm_8cpp.html#a8b9043c100c0991d06d72d04328d8c0c">kVmmpNumberOfProcessors</a></div><div class="ttdeci">static const long kVmmpNumberOfProcessors</div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00038">vmm.cpp:38</a></div></div>
<div class="ttc" id="vmm_8cpp_html_ae335e24227daf5739435eeb6789142a6"><div class="ttname"><a href="vmm_8cpp.html#ae335e24227daf5739435eeb6789142a6">VmmpHandleMsrAccess</a></div><div class="ttdeci">static void VmmpHandleMsrAccess(_Inout_ GuestContext *guest_context, _In_ bool read_access)</div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbae159272ee4e15f08b504f4e80f7aa0e8"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbae159272ee4e15f08b504f4e80f7aa0e8">VmcsField::kVmEntryInstructionLen</a></div></div>
<div class="ttc" id="union_page_fault_error_code_html_a32d292646865e1b4a7292bf08c7fe448"><div class="ttname"><a href="union_page_fault_error_code.html#a32d292646865e1b4a7292bf08c7fe448">PageFaultErrorCode::all</a></div><div class="ttdeci">ULONG32 all</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00437">ia32_type.h:437</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba9e03ba9dfed3f51a2363504c338eea21"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba9e03ba9dfed3f51a2363504c338eea21">VmcsField::kGuestLdtrBase</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba9a8878cb4a8fb3efb11cc1b48d11fd67"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba9a8878cb4a8fb3efb11cc1b48d11fd67">VmcsField::kGuestFsSelector</a></div></div>
<div class="ttc" id="union_vm_entry_interruption_information_field_html_afc19f2e9d19eb6880276bdb355d63119"><div class="ttname"><a href="union_vm_entry_interruption_information_field.html#afc19f2e9d19eb6880276bdb355d63119">VmEntryInterruptionInformationField::deliver_error_code</a></div><div class="ttdeci">ULONG32 deliver_error_code</div><div class="ttdoc">[11] </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01338">ia32_type.h:1338</a></div></div>
<div class="ttc" id="asm_8h_html_a55f8f0cb783f43b81d084ed8c54b63eb"><div class="ttname"><a href="asm_8h.html#a55f8f0cb783f43b81d084ed8c54b63eb">AsmWriteCR2</a></div><div class="ttdeci">void __stdcall AsmWriteCR2(_In_ ULONG_PTR cr2_value)</div><div class="ttdoc">Writes to CR2. </div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba42d029a82770b0ea7a690f215bb388ad"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba42d029a82770b0ea7a690f215bb388ad">VmcsField::kVmInstructionError</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a66faebb03d006844eb8f9306d9d438feab0e93ecf521b9cad7e7b7bcaf49a591b"><div class="ttname"><a href="ia32__type_8h.html#a66faebb03d006844eb8f9306d9d438feab0e93ecf521b9cad7e7b7bcaf49a591b">MovCrAccessType::kClts</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbac2061da2b42033870d7f40a5b528736a"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbac2061da2b42033870d7f40a5b528736a">VmcsField::kGuestIdtrLimit</a></div></div>
<div class="ttc" id="vmm_8cpp_html_af96290550a514b6931f9eca8a3dda239"><div class="ttname"><a href="vmm_8cpp.html#af96290550a514b6931f9eca8a3dda239">VmmpHandleDrAccess</a></div><div class="ttdeci">static void VmmpHandleDrAccess(_Inout_ GuestContext *guest_context)</div></div>
<div class="ttc" id="struct_gp_registers_x86_html_abca0e685f3512da486bbbac8fab0e661"><div class="ttname"><a href="struct_gp_registers_x86.html#abca0e685f3512da486bbbac8fab0e661">GpRegistersX86::bp</a></div><div class="ttdeci">ULONG_PTR bp</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00090">ia32_type.h:90</a></div></div>
<div class="ttc" id="asm_8h_html_a0e87423ee42eebf6a70fc1d75d71d0f5"><div class="ttname"><a href="asm_8h.html#a0e87423ee42eebf6a70fc1d75d71d0f5">__lgdt</a></div><div class="ttdeci">void __lgdt(_In_ void *gdtr)</div><div class="ttdoc">Reads SGDT. </div><div class="ttdef"><b>Definition:</b> <a href="asm_8h_source.html#l00172">asm.h:172</a></div></div>
<div class="ttc" id="union_mov_dr_qualification_html_a72c9ea745b7acc3fb72b78df3c330d10"><div class="ttname"><a href="union_mov_dr_qualification.html#a72c9ea745b7acc3fb72b78df3c330d10">MovDrQualification::fields</a></div><div class="ttdeci">struct MovDrQualification::@26 fields</div></div>
<div class="ttc" id="common_8h_html"><div class="ttname"><a href="common_8h.html">common.h</a></div><div class="ttdoc">Declares and implements common things across the project. </div></div>
<div class="ttc" id="vmm_8cpp_html_a9dd0aea373b81895ec20012fc9b1a546"><div class="ttname"><a href="vmm_8cpp.html#a9dd0aea373b81895ec20012fc9b1a546">VmmpHandleCrAccess</a></div><div class="ttdeci">static void VmmpHandleCrAccess(_Inout_ GuestContext *guest_context)</div></div>
<div class="ttc" id="asm_8h_html_a79db6c3a490dc84acfe8ba14268131b8"><div class="ttname"><a href="asm_8h.html#a79db6c3a490dc84acfe8ba14268131b8">AsmInvlpg</a></div><div class="ttdeci">void __stdcall AsmInvlpg(_In_ ULONG_PTR virtual_address)</div><div class="ttdoc">Invalidates TLB entries. </div></div>
<div class="ttc" id="struct_vm_exit_history_html_ac8168e9d3351a5af2729709a8a685fbd"><div class="ttname"><a href="struct_vm_exit_history.html#ac8168e9d3351a5af2729709a8a685fbd">VmExitHistory::exit_reason</a></div><div class="ttdeci">VmExitInformation exit_reason</div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00074">vmm.cpp:74</a></div></div>
<div class="ttc" id="vmm_8h_html_add3e29dd561f28c7f3ad0bfe070d807a"><div class="ttname"><a href="vmm_8h.html#add3e29dd561f28c7f3ad0bfe070d807a">kHyperPlatformVmmBackdoorCode</a></div><div class="ttdeci">static const ULONG kHyperPlatformVmmBackdoorCode</div><div class="ttdoc">A backdoor code to tell the VMM that a caller knows about the VMM. </div><div class="ttdef"><b>Definition:</b> <a href="vmm_8h_source.html#l00024">vmm.h:24</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ad7fa819ac11bf3c318c37fe162898ea9ae82ac88caedfaddc8f1d0ecf27403562"><div class="ttname"><a href="ia32__type_8h.html#ad7fa819ac11bf3c318c37fe162898ea9ae82ac88caedfaddc8f1d0ecf27403562">LdtrOrTrInstructionIdentity::kLldt</a></div></div>
<div class="ttc" id="struct_guest_context_html_abc69d3291f49cb0014a9b03f0e7fe57e"><div class="ttname"><a href="struct_guest_context.html#abc69d3291f49cb0014a9b03f0e7fe57e">GuestContext::ip</a></div><div class="ttdeci">ULONG_PTR ip</div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00059">vmm.cpp:59</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba698c331a2e83e54a458a82d454234cff"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba698c331a2e83e54a458a82d454234cff">VmcsField::kGuestFsBase</a></div></div>
<div class="ttc" id="union_ldtr_or_tr_access_qualification_html_a6570958b95ef3acf34a621df47a24791"><div class="ttname"><a href="union_ldtr_or_tr_access_qualification.html#a6570958b95ef3acf34a621df47a24791">LdtrOrTrAccessQualification::address_size</a></div><div class="ttdeci">ULONG32 address_size</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01088">ia32_type.h:1088</a></div></div>
<div class="ttc" id="util_8cpp_html_ae031e3644a8ebf1146b50ac00700b7a6"><div class="ttname"><a href="util_8cpp.html#ae031e3644a8ebf1146b50ac00700b7a6">UtilReadMsr64</a></div><div class="ttdeci">ULONG64 UtilReadMsr64(Msr msr)</div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00626">util.cpp:626</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba19eab298a3aba40b9345084fd72e916c"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba19eab298a3aba40b9345084fd72e916c">VmcsField::kGuestLdtrSelector</a></div></div>
<div class="ttc" id="struct_idtr_html"><div class="ttname"><a href="struct_idtr.html">Idtr</a></div><div class="ttdoc">See: MEMORY-MANAGEMENT REGISTERS. </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00168">ia32_type.h:168</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbaa3fe77bd1848081d4791d1b8802e0a06"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaa3fe77bd1848081d4791d1b8802e0a06">VmcsField::kGuestCsBase</a></div></div>
<div class="ttc" id="union_gdtr_or_idtr_access_qualification_html"><div class="ttname"><a href="union_gdtr_or_idtr_access_qualification.html">GdtrOrIdtrAccessQualification</a></div><div class="ttdoc">See: Format of the VM-Exit Instruction-Information Field as Used for LIDT, LGDT, SIDT, or SGDT. </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01052">ia32_type.h:1052</a></div></div>
<div class="ttc" id="struct_vm_exit_history_html_a412ad5fbaba05cfe66f3db580efc29df"><div class="ttname"><a href="struct_vm_exit_history.html#a412ad5fbaba05cfe66f3db580efc29df">VmExitHistory::exit_qualification</a></div><div class="ttdeci">ULONG_PTR exit_qualification</div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00075">vmm.cpp:75</a></div></div>
<div class="ttc" id="vmm_8cpp_html_a6e683d7408cf291fb1131a178c0d133f"><div class="ttname"><a href="vmm_8cpp.html#a6e683d7408cf291fb1131a178c0d133f">g_vmmp_vm_exit_history</a></div><div class="ttdeci">static VmExitHistory g_vmmp_vm_exit_history[kVmmpNumberOfProcessors][kVmmpNumberOfRecords]</div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00150">vmm.cpp:150</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbae751115f33e5898d215ddfd370a8c5a2"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbae751115f33e5898d215ddfd370a8c5a2">VmcsField::kGuestCsSelector</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a555d15179398f3cd5a63b13d997f9cbcaaad8e1a6ae2ec4d575688546345b84ca"><div class="ttname"><a href="ia32__type_8h.html#a555d15179398f3cd5a63b13d997f9cbcaaad8e1a6ae2ec4d575688546345b84ca">GdtrOrIdtrScaling::kScaleBy2</a></div></div>
<div class="ttc" id="struct_vm_exit_history_html_a41ddef6ad3fc5d52efebb34ff46054ed"><div class="ttname"><a href="struct_vm_exit_history.html#a41ddef6ad3fc5d52efebb34ff46054ed">VmExitHistory::instruction_info</a></div><div class="ttdeci">ULONG_PTR instruction_info</div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00076">vmm.cpp:76</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9eab290f1c7552c2313218c85a8edf2e799"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9eab290f1c7552c2313218c85a8edf2e799">VmxExitReason::kExceptionOrNmi</a></div></div>
<div class="ttc" id="log_8h_html"><div class="ttname"><a href="log_8h.html">log.h</a></div><div class="ttdoc">Declares interfaces to logging functions. </div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbad708a22ea3cc689e34d77901b79a83fc"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbad708a22ea3cc689e34d77901b79a83fc">VmcsField::kGuestTrBase</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba08ff5cc964d68afb3830d42f5fb0ac06"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba08ff5cc964d68afb3830d42f5fb0ac06">VmcsField::kGuestSsLimit</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a65b496b2a5595032807adc67e57e2e9ea165a59a3761aa65c1d58d404c5a56a92"><div class="ttname"><a href="ia32__type_8h.html#a65b496b2a5595032807adc67e57e2e9ea165a59a3761aa65c1d58d404c5a56a92">Msr::kIa32FsBase</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba841afcc77157df576377fa5cb30936b7"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba841afcc77157df576377fa5cb30936b7">VmcsField::kGuestLdtrArBytes</a></div></div>
<div class="ttc" id="union_ldtr_or_tr_access_qualification_html_ac6fa2923a80016ca3ae735c2facdd106"><div class="ttname"><a href="union_ldtr_or_tr_access_qualification.html#ac6fa2923a80016ca3ae735c2facdd106">LdtrOrTrAccessQualification::register1</a></div><div class="ttdeci">ULONG32 register1</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01087">ia32_type.h:1087</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba301858c51fa8d6d9bc596974f75db658"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba301858c51fa8d6d9bc596974f75db658">VmcsField::kGuestEsLimit</a></div></div>
<div class="ttc" id="asm_8h_html_aebe13d56500a53aae4de580a01a8f61f"><div class="ttname"><a href="asm_8h.html#aebe13d56500a53aae4de580a01a8f61f">AsmInvalidateInternalCaches</a></div><div class="ttdeci">void __stdcall AsmInvalidateInternalCaches()</div><div class="ttdoc">Invalidates internal caches. </div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbacf4a77606486bce3eba145b38653cc5f"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbacf4a77606486bce3eba145b38653cc5f">VmcsField::kGuestTrArBytes</a></div></div>
<div class="ttc" id="struct_gp_registers_x86_html_a87d569237c5526ffcf1ba68b29a152cb"><div class="ttname"><a href="struct_gp_registers_x86.html#a87d569237c5526ffcf1ba68b29a152cb">GpRegistersX86::cx</a></div><div class="ttdeci">ULONG_PTR cx</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00094">ia32_type.h:94</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbafcca9ad8e93010093cc770d18499b840"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbafcca9ad8e93010093cc770d18499b840">VmcsField::kGuestTrLimit</a></div></div>
<div class="ttc" id="vmm_8cpp_html_a1c01a0073985999db6eaf5836fdaf56a"><div class="ttname"><a href="vmm_8cpp.html#a1c01a0073985999db6eaf5836fdaf56a">VmmpSelectRegister</a></div><div class="ttdeci">static ULONG_PTR * VmmpSelectRegister(_In_ ULONG index, _In_ GuestContext *guest_context)</div></div>
<div class="ttc" id="util_8h_html_a131ab25ba676523d82ffa34bfba7f79d"><div class="ttname"><a href="util_8h.html#a131ab25ba676523d82ffa34bfba7f79d">UtilIsInBounds</a></div><div class="ttdeci">constexpr bool UtilIsInBounds(_In_ const T &amp;value, _In_ const T &amp;min, _In_ const T &amp;max)</div><div class="ttdoc">Tests if value is in between min and max. </div><div class="ttdef"><b>Definition:</b> <a href="util_8h_source.html#l00250">util.h:250</a></div></div>
<div class="ttc" id="union_ldtr_or_tr_access_qualification_html_ac72397ee67a211e0f4caf8f2791cea0b"><div class="ttname"><a href="union_ldtr_or_tr_access_qualification.html#ac72397ee67a211e0f4caf8f2791cea0b">LdtrOrTrAccessQualification::index_register_invalid</a></div><div class="ttdeci">ULONG32 index_register_invalid</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01093">ia32_type.h:1093</a></div></div>
<div class="ttc" id="common_8h_html_a025de454ae4eec948d955fd67b2c1a47aaab5123b0ff34361100d04874b2846b0"><div class="ttname"><a href="common_8h.html#a025de454ae4eec948d955fd67b2c1a47aaab5123b0ff34361100d04874b2846b0">HyperPlatformBugCheck::kUnexpectedVmExit</a></div><div class="ttdoc">An unexpected VM-exit occured. </div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cbaff5d1adc02fe91c8b63f6c8a36229bcc"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cbaff5d1adc02fe91c8b63f6c8a36229bcc">VmcsField::kGuestCr3</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ad7fa819ac11bf3c318c37fe162898ea9a9c0ea5013445ed4614482b090568f3a0"><div class="ttname"><a href="ia32__type_8h.html#ad7fa819ac11bf3c318c37fe162898ea9a9c0ea5013445ed4614482b090568f3a0">LdtrOrTrInstructionIdentity::kSldt</a></div></div>
<div class="ttc" id="vmm_8cpp_html_aca9ba59e93c665bb5b0b0cb82696ad23"><div class="ttname"><a href="vmm_8cpp.html#aca9ba59e93c665bb5b0b0cb82696ad23">VmmpHandleMsrWriteAccess</a></div><div class="ttdeci">static void VmmpHandleMsrWriteAccess(_Inout_ GuestContext *guest_context)</div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9ea1311497c9bd49aed82c0e26d5f9af165"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9ea1311497c9bd49aed82c0e26d5f9af165">VmxExitReason::kVmptrld</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9eaa6863cb53d5be0e0a58837f7a2445281"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9eaa6863cb53d5be0e0a58837f7a2445281">VmxExitReason::kXsetbv</a></div></div>
<div class="ttc" id="ia32__type_8h_html_ab6bf098f238abeaea146d16cf6bc3e9eaa8801b22dbe213af1b02ff16f53c7f87"><div class="ttname"><a href="ia32__type_8h.html#ab6bf098f238abeaea146d16cf6bc3e9eaa8801b22dbe213af1b02ff16f53c7f87">VmxExitReason::kVmcall</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a65b496b2a5595032807adc67e57e2e9ea266e45b2e9e260c75a7afaa15108fe0f"><div class="ttname"><a href="ia32__type_8h.html#a65b496b2a5595032807adc67e57e2e9ea266e45b2e9e260c75a7afaa15108fe0f">Msr::kIa32GsBase</a></div></div>
<div class="ttc" id="union_gdtr_or_idtr_access_qualification_html_aaff7ea2bf96c145ab9d5827fbe6e99fd"><div class="ttname"><a href="union_gdtr_or_idtr_access_qualification.html#aaff7ea2bf96c145ab9d5827fbe6e99fd">GdtrOrIdtrAccessQualification::scalling</a></div><div class="ttdeci">ULONG32 scalling</div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01055">ia32_type.h:1055</a></div></div>
<div class="ttc" id="union_flag_register_html_a591a5bf75301f1d91de07a1bbad83d78"><div class="ttname"><a href="union_flag_register.html#a591a5bf75301f1d91de07a1bbad83d78">FlagRegister::of</a></div><div class="ttdeci">ULONG_PTR of</div><div class="ttdoc">[11] Overflow flag </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00051">ia32_type.h:51</a></div></div>
<div class="ttc" id="struct_processor_data_html"><div class="ttname"><a href="struct_processor_data.html">ProcessorData</a></div><div class="ttdoc">Represents VMM related data associated with each processor. </div><div class="ttdef"><b>Definition:</b> <a href="vmm_8h_source.html#l00039">vmm.h:39</a></div></div>
<div class="ttc" id="struct_vm_exit_history_html_a3ab2f6965ead4e01f6141ce84ed27f47"><div class="ttname"><a href="struct_vm_exit_history.html#a3ab2f6965ead4e01f6141ce84ed27f47">VmExitHistory::ip</a></div><div class="ttdeci">ULONG_PTR ip</div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00073">vmm.cpp:73</a></div></div>
<div class="ttc" id="ia32__type_8h_html_a46733ebfd60eed3f1539af888cb983cba56a28a031f551cd3eb18ca1054176819"><div class="ttname"><a href="ia32__type_8h.html#a46733ebfd60eed3f1539af888cb983cba56a28a031f551cd3eb18ca1054176819">VmcsField::kGuestSsBase</a></div></div>
<div class="ttc" id="struct_vmm_initial_stack_html"><div class="ttname"><a href="struct_vmm_initial_stack.html">VmmInitialStack</a></div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00046">vmm.cpp:46</a></div></div>
<div class="ttc" id="struct_all_registers_html"><div class="ttname"><a href="struct_all_registers.html">AllRegisters</a></div><div class="ttdoc">Reprsents a stack layout after a sequence of PUSHFx, PUSHAx. </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l00106">ia32_type.h:106</a></div></div>
<div class="ttc" id="vmm_8cpp_html_a4dd19279ad356f9d6c2f43601b2f233a"><div class="ttname"><a href="vmm_8cpp.html#a4dd19279ad356f9d6c2f43601b2f233a">VmmpHandleException</a></div><div class="ttdeci">static void VmmpHandleException(_Inout_ GuestContext *guest_context)</div></div>
<div class="ttc" id="struct_guest_context_html_a119437e05b54a8082c042df7df80d320"><div class="ttname"><a href="struct_guest_context.html#a119437e05b54a8082c042df7df80d320">GuestContext::cr8</a></div><div class="ttdeci">ULONG_PTR cr8</div><div class="ttdef"><b>Definition:</b> <a href="vmm_8cpp_source.html#l00060">vmm.cpp:60</a></div></div>
<div class="ttc" id="union_vm_exit_interruption_information_field_html_a05324c3bd75ef11750ed9a2f2db30b2e"><div class="ttname"><a href="union_vm_exit_interruption_information_field.html#a05324c3bd75ef11750ed9a2f2db30b2e">VmExitInterruptionInformationField::vector</a></div><div class="ttdeci">ULONG32 vector</div><div class="ttdoc">[0:7] </div><div class="ttdef"><b>Definition:</b> <a href="ia32__type_8h_source.html#l01322">ia32_type.h:1322</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
